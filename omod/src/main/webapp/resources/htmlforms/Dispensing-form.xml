<htmlform formUuid="340fe8d8-4984-11ea-b77f-2e728ce88125"
          formName="Dispensing form"
          formEncounterType="22902411-19c1-4a02-b19a-bf1a9c24fd51"
          formVersion="3.0"
          formDescription="This Form dispenses medications prescribed for a patient"
          formAddMetadata="yes"
          formUILocation="patientDashboard.visitActions"
          formOrder="8"
          formIcon="icon-medkit"
          formShowIf="(visit.active || !visit.active) &amp;&amp; patient.person.dead==false &amp;&amp; sessionLocation.uuid=='3ec8ff90-3ec1-408e-bf8c-22e4553d6e17'"
          formDisplayStyle="Standard"
          formLabel="Medication Dispensing Form">

    <script type="text/javascript">
        if (jQuery) {
            jq(document).ready(function () {
                $allRows = jq(this).find('.multi-drug');
                $allRows.hide();
                jq('#1-removeEntry').remove();
                jq('#10-addEntry').remove();
                jq('#1-toggleContainer').show();
                jq('#11-removeEntry').remove();
                jq('#20-addEntry').remove();
                jq('#11-toggleContainer').show();
            });

            jq(document).ready(function () {
                jq('.addEntry').on("click", function () {
                    var correctedAddButtonId = parseFloat(this.id) + 1;
                    var contentAddId = "#" + correctedAddButtonId + "-toggleContainer";
                    jq(contentAddId).toggle(true);
                    jq('#' + this.id).toggle(false);
                    jq('#' + parseFloat(this.id) + '-removeEntry').toggle(true);
                    return false;
                });
            });

            jq(document).ready(function () {
                jq('.removeEntry').on("click", function () {
                    var correctedRemoveButtonId = parseFloat(this.id) - 1;
                    var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer";
                    jq(contentAddId).toggle(false);
                    jq(':input:not(:button)', contentAddId).val([]);
                    jq('#' + correctedRemoveButtonId + '-addEntry').toggle(true);
                    jq('#' + correctedRemoveButtonId + '-removeEntry').toggle(true);

                    return false;
                });
            });


            jq(document).ready(function () {
                $allRows_other = jq(this).find('.multi-drug-other');
                    $allRows_other.hide();
                    jq('#1-removeEntry-other').remove();
                    jq('#10-addEntry-other').remove();
                    jq('#1-toggleContainer-other').show();
                    jq('#11-removeEntry-other').remove();
                    jq('#20-addEntry-other').remove();
                    jq('#11-toggleContainer-other').show();
            });

            jq(document).ready(function () {
                jq('.addEntry-other').on("click", function () {
                var correctedAddButtonId = parseFloat(this.id) + 1;
                var contentAddId = "#" + correctedAddButtonId + "-toggleContainer-other";
                jq(contentAddId).toggle(true);
                jq('#' + this.id).toggle(false);
                jq('#' + parseFloat(this.id) + '-removeEntry-other').toggle(true);
                return false;
                });
            });

            jq(document).ready(function () {
                jq('.removeEntry-other').on("click", function () {
                var correctedRemoveButtonId = parseFloat(this.id) - 1;
                var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer-other";
                jq(contentAddId).toggle(false);
                jq(':input:not(:button)', contentAddId).val([]);
                jq('#' + correctedRemoveButtonId + '-addEntry-other').toggle(true);
                jq('#' + correctedRemoveButtonId + '-removeEntry-other').toggle(true);
                return false;
                });

            });

            jq(document).ready(function () {
                $allRows = jq(this).find('.multi-arv-drug');
                $allRows.hide();
                jq('#1-removeEntry1-other').remove();
                jq('#10-addEntry1-other').remove();
                jq('#1-toggleContainer1-other').show();
                jq('#11-removeEntry').remove();
                jq('#20-addEntry1-other').remove();
                jq('#11-toggleContainer1-other').show();
                });

            jq(document).ready(function () {
                jq('.addEntry-other1').on("click", function () {
                var correctedAddButtonId = parseFloat(this.id) + 1;
                var contentAddId = "#" + correctedAddButtonId + "-toggleContainer1-other";
                jq(contentAddId).toggle(true);
                jq('#' + this.id).toggle(false);
                jq('#' + parseFloat(this.id) + '-removeEntry1-other').toggle(true);
                return false;
              });
            });

            jq(document).ready(function () {
                jq('.removeEntry-other1').on("click", function () {
                var correctedRemoveButtonId = parseFloat(this.id) - 1;
                var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer1-other";
                jq(contentAddId).toggle(false);
                jq(':input:not(:button)', contentAddId).val([]);
                jq('#' + correctedRemoveButtonId + '-addEntry1-other').toggle(true);
                jq('#' + correctedRemoveButtonId + '-removeEntry1-other').toggle(true);
                return false;
                });

              });

        }
        <ifMode mode = "EDIT" >
            jq(document).ready(function () {
            $allRows = jq(this).find('.multi-drug');
            $allRows.hide();
            jq('#1-removeEntry').remove();
            jq('#10-addEntry').remove();
            jq('#1-toggleContainer').show();
            jq('#11-removeEntry').remove();
            jq('#20-addEntry').remove();
            jq('#11-toggleContainer').show();
            for (let x = 0; x&lt;= 10; x++) {
                 if (jq(this).find('#' +x+ '-drug').find("input[type$='text']").val()!='')
                    {
                        jq(this).find('#' +x+ '-toggleContainer').show();
                        jq(this).find('#' +x+ '-addEntry').hide();
                    }
                else {
                    x-=1;
                    jq(this).find('#' +x+ '-addEntry').show();
                    break;
                    }
                }
            });

            jq(document).ready(function () {
            $allRows_other = jq(this).find('.multi-drug-other');
            $allRows_other.hide();
            jq('#1-removeEntry-other').remove();
            jq('#10-addEntry-other').remove();
            jq('#1-toggleContainer-other').show();
            jq('#11-removeEntry-other').remove();
            jq('#20-addEntry-other').remove();
            jq('#11-toggleContainer-other').show();
            for (let x = 0; x&lt;= 10; x++) {
                 if (jq(this).find('#' +x+ '-drugother').find("input[type$='text']").val()!='')
                    {
                        jq(this).find('#' +x+ '-toggleContainer-other').show();
                        jq(this).find('#' +x+ '-addEntry-other').hide();
                    }
                else {
                    x-=1;
                    jq(this).find('#' +x+ '-addEntry-other').show();
                    break;
                    }
                 }
            });
        </ifMode>


    </script>


    <style>
        .card .row {
            margin-bottom: 0px;
        }
    </style>

    <div class="row">
        <div class="col-md-6">
            <h1>Medical Dispensing Form</h1>
        </div>
        <div class="col-md-5"></div>
        <div class="col-md-1 submitButton">
            <postSubmissionAction class="org.openmrs.module.ugandaemrpoc.htmlformentry.DispensingFormSubmissionAction"/>
            <submit class="confirm" submitLabel="Save"/>
        </div>
    </div>

    <div class="row">
            <div class="col-md-12">
               <div class="card">
                     <div class="card-header">
                         <ul class="nav nav-tabs card-header-tabs nav-fill">
                         <li class="nav-item">
                             <a class="nav-link active" data-toggle="tab" href="#encounter-details">
                                 Encounter Details
                             </a>
                         </li>
                         <li class="nav-item">
                             <a class="nav-link" data-toggle="tab" href="#essential-medications">
                                Essential Medications
                             </a>
                         </li>
                             <li class="nav-item">
                                 <a class="nav-link" data-toggle="tab" href="#other-medications">
                                     Other Medications
                                 </a>
                             </li>
                         </ul>
                     </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <div class="tab-pane active" id="encounter-details">
                            <section>
                                <div class="card">
                                    <div class="card-header">Visit Details</div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-3" id="visit-date">
                                                <label>Visit Date</label>
                                                <encounterDate default="today" disallowMultipleEncountersOnDate="block"/>
                                            </div>

                                            <div class="col-md-3">
                                                <label><span class="required">*</span>Attending Clinician</label>
                                                <encounterProvider role="Provider" style="autocomplete" id="provider"/>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                            <div class="tab-pane" id="essential-medications">
                                <section>
                                    <div class="card">
                                            <div class="card-header">
                                                <label>Essential Medications</label>
                                            </div>
                                                <div class="card-body">
                                                    <div>
                                                        <repeat>
                                                            <template>
                                                                <obsgroup groupingConceptId="160741">
                                                                    <div class="row multi-drug" id="{id}-toggleContainer">
                                                                        <div class="col-2">
                                                                            <obs labelText="Drugs"  id="{id}-drug" conceptId="1282" answerClasses="Drug" style="autocomplete" class="fullwidth"/>
                                                                        </div>
                                                                        <div class="col-2">
                                                                            <obs labelText="Quantity" conceptId="160856"/>
                                                                        </div>
                                                                        <div class="col-2">
                                                                            <obs labelText="Qty unit" conceptId="165791" answerConceptSetIds="162402,162384"/>
                                                                        </div>
                                                                        <div class="col-2 duration">
                                                                            <label>Duration</label>
                                                                            <obs conceptId="159368"/>
                                                                        </div>
                                                                        <div class="col-2">
                                                                            <obs conceptId="1732" labelText="Duration unit"/>
                                                                        </div>
                                                                        <div class="col-2">
                                                                            <div class="add-entry">
                                                                                <a href="#" id="{id}-addEntry" class="addEntry add-more-link"><i class="icon-plus-sign"></i></a>
                                                                                <a href="#" class="removeEntry remove-more-link" id="{id}-removeEntry"><i class="icon-minus"></i></a>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </obsgroup>
                                                            </template>
                                                            <render id="1"/>
                                                            <render id="2"/>
                                                            <render id="3"/>
                                                            <render id="4"/>
                                                            <render id="5"/>
                                                            <render id="6"/>
                                                            <render id="7"/>
                                                            <render id="8"/>
                                                            <render id="9"/>
                                                            <render id="10"/>
                                                        </repeat>
                                                    </div>
                                                </div>
                                    </div>
                                </section>
                            </div>

                            <div class="tab-pane" id="other-medications">
                                <section>
                                    <div class="card">
                                        <div class="card-header">
                                            <label>Other Medications</label>
                                        </div>
                                        <div class="card-body">
                                            <div>
                                                <repeat>
                                                    <template>
                                                        <obsgroup groupingConceptId="165874">
                                                            <div class="row multi-drug-other" id="{id}-toggleContainer-other">
                                                                <div class="col-2">
                                                                    <obs labelText="Drug" id="{id}-drugother" conceptId="99035" class="fullwidth"/>
                                                                </div>
                                                                <div class="col-2">
                                                                    <obs labelText="Quantity" conceptId="160856"/>
                                                                </div>
                                                                <div class="col-2">
                                                                    <obs labelText="Qty unit" conceptId="165791" answerConceptSetIds="162402,162384"/>
                                                                </div>
                                                                <div class="col-2 duration">
                                                                    <label>Duration</label>
                                                                    <obs conceptId="159368"/>
                                                                </div>
                                                                <div class="col-2">
                                                                    <obs conceptId="1732" labelText="Duration unit"/>
                                                                </div>
                                                                <div class="col-2">
                                                                    <div class="add-entry">
                                                                        <a href="#" id="{id}-addEntry-other" class="addEntry-other add-more-link"><i class="icon-plus-sign"></i></a>
                                                                        <a href="#" class="removeEntry-other remove-more-link" id="{id}-removeEntry-other"><i class="icon-minus"></i></a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </obsgroup>
                                                    </template>
                                                    <render id="1"/>
                                                    <render id="2"/>
                                                    <render id="3"/>
                                                    <render id="4"/>
                                                    <render id="5"/>
                                                    <render id="6"/>
                                                    <render id="7"/>
                                                    <render id="8"/>
                                                    <render id="9"/>
                                                    <render id="10"/>
                                                </repeat>
                                            </div>
                                        </div>
                                    </div>

                                </section>
                            </div>
                </div>
               </div>
               </div>
    </div>
    </div>


</htmlform>