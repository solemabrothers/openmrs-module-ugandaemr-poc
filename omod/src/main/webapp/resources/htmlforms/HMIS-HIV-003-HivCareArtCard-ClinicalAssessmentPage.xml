<htmlform formName="HMIS 003 HIV Care ART Card - Clinical Assessment"
          formDescription="A visit for a client for clinical assessment "
          formEncounterType="8d5b2be0-c2cc-11de-8d13-0010c6dffd0f"
          formUuid="12de5bc5-352e-4faf-9961-a2125085a75c"
          formVersion="3.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.visitActions"
          formOrder="0"
          formIcon="icon-medkit"
          formShowIf="(visit.active || !visit.active) &amp;&amp; patient.person.dead==false &amp;&amp; sessionLocation.uuid=='86863db4-6101-4ecf-9a86-5e716d6504e4'"
          formDisplayStyle="Standard">
    <ifMode mode="ENTER,EDIT" include="false">
        <includeIf velocityTest="$fn.allEncounters('8d5b27bc-c2cc-11de-8d13-0010c6dffd0f').size() == 0">
            <script>
                jq(function () {
                    jq().toastmessage('showErrorToast', "This patient has no Summary page");
                    alert('This patient has no Summary page, you will now be forwarded to the patient dashboard');

                    /*
                    * queryParameters -> handles the query string parameters
                    * queryString -> the query string without the fist '?' character
                    * re -> the regular expression
                    * m -> holds the string matching the regular expression
                    */
                    var queryParameters = {}, queryString = location.search.substring(1),
                        re = /([^&amp;=]+)=([^&amp;]*)/g, m;

                    // Creates a map with the query string parameters
                    while (m = re.exec(queryString)) {
                        queryParameters[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
                    }

                    /*
                    * Replace the query portion of the URL.
                    * jQuery.param() -> create a serialized representation of an array or
                    * object, suitable for use in a URL query string or Ajax request.
                    */
                    location.href = window.location.protocol + "//" + window.location.host +
                        '/' + OPENMRS_CONTEXT_PATH + '/coreapps/clinicianfacing/patient.page?patientId='
                        + queryParameters['patientId']; // Causes page to reload
                });
            </script>
        </includeIf>
    </ifMode>
    <!-- jquery loaded for nonessential purposes. -->

    <script type="text/javascript">

        if (jQuery) {
           jq(document).ready(function () {
                $allRows_other = jq(this).find('.multi-drug-other');
                $allRows_other.hide();
                jq('#1-removeEntry-other').remove();
                jq('#10-addEntry-other').remove();
                jq('#1-toggleContainer-other').show();

                jq('#11-removeEntry-other').remove();
                jq('#20-addEntry-other').remove();
                jq('#11-toggleContainer-other').show();
                });

           jq(document).ready(function () {
                jq('.addEntry-other').on("click", function () {
                var correctedAddButtonId = parseFloat(this.id) + 1;
                var contentAddId = "#" + correctedAddButtonId + "-toggleContainer-other";
                jq(contentAddId).toggle(true);
                jq('#' + this.id).toggle(false);
                jq('#' + parseFloat(this.id) + '-removeEntry-other').toggle(true);
                return false;
                });
                });

           jq(document).ready(function () {
                jq('.removeEntry-other').on("click", function () {
                var correctedRemoveButtonId = parseFloat(this.id) - 1;
                var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer-other";
                jq(contentAddId).toggle(false);
                jq(':input:not(:button)', contentAddId).val([]);
                jq('#' + correctedRemoveButtonId + '-addEntry-other').toggle(true);
                jq('#' + correctedRemoveButtonId + '-removeEntry-other').toggle(true);

                return false;
                });

                });

           jq(document).ready(function () {
                $allRows = jq(this).find('.multi-arv-drug');
                $allRows.hide();
                jq('#1-removeEntry1-other').remove();
                jq('#10-addEntry1-other').remove();
                jq('#1-toggleContainer1-other').show();

                jq('#11-removeEntry').remove();
                jq('#20-addEntry1-other').remove();
                jq('#11-toggleContainer1-other').show();
                });

           jq(document).ready(function () {
                jq('.addEntry-other1').on("click", function () {
                var correctedAddButtonId = parseFloat(this.id) + 1;
                var contentAddId = "#" + correctedAddButtonId + "-toggleContainer1-other";
                jq(contentAddId).toggle(true);
                jq('#' + this.id).toggle(false);
                jq('#' + parseFloat(this.id) + '-removeEntry1-other').toggle(true);
                return false;
                });
                });

           jq(document).ready(function () {
                jq('.removeEntry-other1').on("click", function () {
                var correctedRemoveButtonId = parseFloat(this.id) - 1;
                var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer1-other";
                jq(contentAddId).toggle(false);
                jq(':input:not(:button)', contentAddId).val([]);
                jq('#' + correctedRemoveButtonId + '-addEntry1-other').toggle(true);
                jq('#' + correctedRemoveButtonId + '-removeEntry1-other').toggle(true);
                return false;
                });

        });




        jq(document).ready(function () {
                $allRows = jq(this).find('.multi-drug');
                $allRows.hide();
                jq('#1-removeEntry').remove();
                jq('#10-addEntry').remove();
                jq('#1-toggleContainer').show();

                jq('#11-removeEntry').remove();
                jq('#20-addEntry').remove();
                jq('#11-toggleContainer').show();
            });


            jq(document).ready(function () {
                jq('.addEntry').on("click", function () {
                    var correctedAddButtonId = parseFloat(this.id) + 1;
                    var contentAddId = "#" + correctedAddButtonId + "-toggleContainer";
                    jq(contentAddId).toggle(true);
                    jq('#' + this.id).toggle(false);
                    jq('#' + parseFloat(this.id) + '-removeEntry').toggle(true);
                    return false;
                });
            });

            jq(document).ready(function () {
                jq('.removeEntry').on("click", function () {
                    var correctedRemoveButtonId = parseFloat(this.id) - 1;
                    var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer";
                    jq(contentAddId).toggle(false);
                    jq(':input:not(:button)', contentAddId).val([]);
                    jq('#' + correctedRemoveButtonId + '-addEntry').toggle(true);
                    jq('#' + correctedRemoveButtonId + '-removeEntry').toggle(true);

                    return false;
                });

            });

            jq(document).ready(function () {
                $allRows = jq(this).find('.multi-test');
                $allRows.hide();
                jq('#1-removeEntry3').remove();
                jq('#10-addEntry3').remove();
                jq('#1-toggleContainer3').show();

                jq('#11-removeEntry').remove();
                jq('#20-addEntry3').remove();
                jq('#11-toggleContainer3').show();
            });

            jq(document).ready(function () {
                jq('.addEntry3').on("click", function () {
                    var correctedAddButtonId = parseFloat(this.id) + 1;
                    var contentAddId = "#" + correctedAddButtonId + "-toggleContainer3";
                    jq(contentAddId).toggle(true);
                    jq('#' + this.id).toggle(false);
                    jq('#' + parseFloat(this.id) + '-removeEntry3').toggle(true);
                    return false;
                });
            });

            jq(document).ready(function () {
                jq('.removeEntry3').on("click", function () {
                    var correctedRemoveButtonId = parseFloat(this.id) - 1;
                    var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer3";
                    jq(contentAddId).toggle(false);
                    jq(':input:not(:button)', contentAddId).val([]);
                    jq('#' + correctedRemoveButtonId + '-addEntry3').toggle(true);
                    jq('#' + correctedRemoveButtonId + '-removeEntry3').toggle(true);
                    return false;
                });
            });


            jq(document).ready(function () {
                $allRows = jq(this).find('.multi-arv-drug');
                $allRows.hide();
                jq('#1-removeEntry1').remove();
                jq('#10-addEntry1').remove();
                jq('#1-toggleContainer1').show();

                jq('#11-removeEntry').remove();
                jq('#20-addEntry1').remove();
                jq('#11-toggleContainer1').show();

                jq('.addEntry1').on("click", function () {
                    var correctedAddButtonId = parseFloat(this.id) + 1;
                    var contentAddId = "#" + correctedAddButtonId + "-toggleContainer1";
                    jq(contentAddId).toggle(true);
                    jq('#' + this.id).toggle(false);
                    jq('#' + parseFloat(this.id) + '-removeEntry1').toggle(true);
                    return false;
                });

                jq('.removeEntry1').on("click", function () {
                    var correctedRemoveButtonId = parseFloat(this.id) - 1;
                    var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer1";
                    jq(contentAddId).toggle(false);
                    jq(':input:not(:button)', contentAddId).val([]);
                    jq('#' + correctedRemoveButtonId + '-addEntry1').toggle(true);
                    jq('#' + correctedRemoveButtonId + '-removeEntry1').toggle(true);

                    return false;
                });

            });
        <ifMode mode = "EDIT" >
            jq(document).ready(function () {
                $allRows = jq(this).find('.multi-drug');
                $allRows.hide();
                jq('#1-removeEntry').remove();
                jq('#10-addEntry').remove();
                jq('#1-toggleContainer').show();
                jq('#11-removeEntry').remove();
                jq('#20-addEntry').remove();
                jq('#11-toggleContainer').show();
                for (let x = 0; x&lt;= 10; x++) {
                     if (jq(this).find('#' +x+ '-drug').find("input[type$='text']").val()!='')
                     {
                         jq(this).find('#' +x+ '-toggleContainer').show();
                          jq(this).find('#' +x+ '-addEntry').hide();
                     }
                    else {
                            x-=1;
                            jq(this).find('#' +x+ '-addEntry').show();
                            break;
                    }
                }
            });

            jq(document).ready(function () {
                $allRows_other = jq(this).find('.multi-drug-other');
                $allRows_other.hide();
                jq('#1-removeEntry-other').remove();
                jq('#10-addEntry-other').remove();
                jq('#1-toggleContainer-other').show();
                jq('#11-removeEntry-other').remove();
                jq('#20-addEntry-other').remove();
                jq('#11-toggleContainer-other').show();
                for (let x = 0; x&lt;= 10; x++) {
                    if (jq(this).find('#' +x+ '-drugother').find("input[type$='text']").val()!='')
                    {
                      jq(this).find('#' +x+ '-toggleContainer-other').show();
                      jq(this).find('#' +x+ '-addEntry-other').hide();
                    }
                    else {
                        x-=1;
                        jq(this).find('#' +x+ '-addEntry-other').show();
                        break;
                    }
                }
            });
        </ifMode>

            var instabilityCause = "";

            jq(document).ready(function () {

                jq("#visit-date").addClass("html-form-entry-disabled-field");
                <!-- Determine muac code based on muac score and age -->
                var age = <lookup complexExpression = "$patient.age" />;

                getMUACCodeFromMUACScoreByAge(age, '1343', '99030');

                //Block Multiple encounter entry on same date
                blockEncounterOnSameDateEncounter(jq("#encounterDate").find("input[type=hidden]"), "block");

                var stableArray = [];

                var previousVl = jq("#vl").text().trim();
                var currentRegimen = jq("#regimen").text().trim();
                var regimenBeforeDTG = jq("#regimen_before_dtg").text().trim();
                var onThirdLine = jq("#on_third_line").text().trim();
                var adherence = jq("#adherence").text().trim();
                var clinicStaging = jq("#clinic_staging").text().trim();
                var regimenStartedDate = jq("#regimen_started_date").text().trim();
                var regimenBeforeDTGStartedDate = jq("#regimen_started_date_before_dtg").text().trim();
                var sputumDate = jq("#sputum_date").text().trim();
                var artStartDate = jq("#art_start_date").text().trim();
                var teatmentStartDate = jq("#teatment_start_date").text().trim();
                var sputumValue = jq("#sputum_value").text().trim();
                var currentRegimenStartDate = jq("#current_regimen_start_date").text().trim();

                if (regimenBeforeDTG &amp;&amp; regimenBeforeDTG !== "") {
                    regimenStartedDate = regimenBeforeDTGStartedDate;
                }

                disable_fields("duration-on-current-regimen");
                disable_fields("duration-on-art");

                var durationOnART;
                var durationOnCurrentRegimen;

                if (artStartDate !== "") {
                    durationOnART = periodBetweenDates(new Date(artStartDate), new Date(jq("#encounterDate").find("input[type=hidden]").val()));
                    jq("#duration-on-art input").val(durationOnART);
                }

                if (currentRegimenStartDate !== "") {
                    durationOnCurrentRegimen = periodBetweenDates(new Date(currentRegimenStartDate), new Date(jq("#encounterDate").find("input[type=hidden]").val()));
                    jq("#duration-on-current-regimen input").val(durationOnCurrentRegimen);
                }

                disableContainer("#patient-categorization");

                DSDMStabilityCheck();

                /* Validation of the ART regimen Selected */
                jq("#art-regimen").change(function () {
                    var regimen_encounter_page_value = jq("#art-regimen").find("select").find(":selected").val();
                    var regimen_encounter_page_text = jq("#art-regimen").find("select").find(":selected").text();
                    var art_transfer_regimen = jq("#artTransferRegimen").html();
                    var other_art_transfer_regimen = jq("#otherArtTransferRegimen").html();
                    var art_start_regimen = jq("#artStartRegimen").html();
                    var other_art_start_regimen = jq("#otherArtStartRegimen").html();
                    var first_second_regimen = jq("#firstSecondLineRegimen").html();
                    var other_first_second_regimen = jq("#otherFirstSecondLineRegimen").html();
                    var third_second_regimen = jq("#thirdLineRegimen").html();
                    var other_third_regimen = jq("#otherThirdLineRegimen").html();
                    var patient_regimen = other_third_regimen + third_second_regimen + other_first_second_regimen + other_first_second_regimen + first_second_regimen + other_art_start_regimen + art_start_regimen + other_art_transfer_regimen + art_transfer_regimen;

                    /* Check if  Patient has art start or tranfer regimen selected on ART Summary Page*/
                    if (art_start_regimen == "null" &amp;&amp; art_transfer_regimen == "null") {
                        jq().toastmessage('showNoticeToast', "Patient Doesn't have any either ART Start or Transfer regimen on ART Summary selected");
                    }

                    if (!patient_regimen.includes(regimen_encounter_page_value)) {
                        jq().toastmessage('showNoticeToast', "The regimen" + regimen_encounter_page_text + "you have selected is different from the current regimen in the Summary page. Please update the summary page with a switch/substitution to the selected regimen");
                    }

                    if (currentRegimen !== jq("#art-regimen").find("select").find(":selected").val()) {
                        jq("#duration-on-current-regimen input").val(0);
                    } else {
                        jq("#duration-on-current-regimen input").val(durationOnCurrentRegimen);
                    }
                    DSDMStabilityCheck();
                });
                /* End of Validation */

                jq("#who-clinic-stage").change(function () {
                    clinicStaging = jq(this).find(":selected").val();
                    DSDMStabilityCheck();
                });


                jq("#reason-for-next-appointment").change(function () {
                    if (jq(this).find("select").find(":selected").val() == "90002") {
                        enable_fields("other-reason-for-next-appointment");
                    } else {
                        jq("#other-reason-for-next-appointment").find("input[type=hidden]").val() == " ";
                        disable_fields("other-reason-for-next-appointment");
                    }
                });


                jq("#99413").change(function () {
                    if (jq(this).find("input[type='radio']:checked").val() == "1065") {
                        enable_fields("99413-target");
                        enable_fields("160856");
                        enable_fields("159368");
                    } else {
                        jq("#99413-target").find("input[type='radio']:checked").val() == " ";
                        disable_fields("99413-target");
                        disable_fields("160856");
                        disable_fields("159368");
                    }
                });
                <ifMode mode="ENTER">
                disable_fields("edd");
                disable_fields("emtct");
                disable_fields("age-in-months");
                disable_fields("anc_no");

                /* disable family planning options*/
                jq(".family-planning-methods").find("input[type$='checkbox']").attr('disabled', true);
                jq(".family-planning-methods").addClass("html-form-entry-disabled-field");

                disable_fields("signs-and-symptoms-enabled");

                //disable TB start date and district number
                disable_fields("tb-start-date");
                disable_fields("district-tb-no");

                //disable/enable TB stop date if client has completed TB treatment
                disable_fields("tb-stop-date");

                /*enable disable tpt attributes*/
                disable_fields("tpt-initiation-date");
                disable_fields("tpt-completion-date");
                disable_fields("tpt-side-effects");

                disable_fields("side-effects-of-art-enabled");
                jq(".hepB-results").find("input[type$='radio']").attr('disabled', true);

                 /* disable Art adherence*/
                 jq(".fair-or-poor-art-adherence-reason").find("input[type$='checkbox']").attr('disabled', true);
                 jq(".fair-or-poor-art-adherence-reason").addClass("html-form-entry-disabled-field");

                 /* enabling and disabling other reasons for poor art adherence*/
                 jq("#other-poor-art-adherence-reason-enabled").find("input[type$='text']").attr("disabled", true);
                 jq("#other-poor-art-adherence-reason-enabled").addClass("html-form-entry-disabled-field");

                 disable_fields("no-of-art-pills");
                 disable_fields("no-of-art-pills-days");
                 disable_fields("split-regimen");

                    /* disabling isonaziad fields  */
                 disable_fields("no-of-isoniazid");
                 disable_fields("duration-on-isoniazid");

                 disable_fields("no-of-dapsone-pills");
                 disable_fields("no-of-dapsone-pills-days");

                    /* disabling vitamin b6 fields  */
                 disable_fields("no-of-vitamin-b6");
                 disable_fields("duration-on-vitamin-b6");

                 disable_fields("fluconazole-stop-date");
                 disable_fields("no-of-fluconazole-pills");
                 disable_fields("no-of-fluconazole-pills-days");

                 disable_fields("other-regimen");

                 disable_fields("other-reason-for-next-appointment");

                 disable_fields("99413-target");
                 disable_fields("160856");
                 disable_fields("159368");
                </ifMode>

                <ifMode mode="EDIT">
                    disable_enable_on_edit_mode("edd");
                    disable_enable_on_edit_mode("emtct");
                    disable_enable_on_edit_mode("age-in-months");
                    disable_enable_on_edit_mode("anc_no");

                    /* enable disable family planning options on edit */
                    if(!jq(".family-planning-methods").find(':checkbox').prop('checked')){
                        jq(".family-planning-methods").find("input[type$='checkbox']").attr('disabled', true);
                        jq(".family-planning-methods").addClass("html-form-entry-disabled-field");
                    }
                    else{
                    jq(".family-planning-methods").find("input[type$='checkbox']").attr('disabled', false);
                    jq(".family-planning-methods").removeClass("html-form-entry-disabled-field");
                    }

                    disable_enable_on_edit_mode("signs-and-symptoms-enabled");
                    disable_enable_on_edit_mode("tb-start-date");
                    disable_enable_on_edit_mode("district-tb-no");
                    disable_enable_on_edit_mode("tb-stop-date");

                    disable_enable_on_edit_mode("tpt-initiation-date");
                    disable_enable_on_edit_mode("tpt-completion-date");
                    disable_enable_on_edit_mode("tpt-side-effects");

                    /* enable disable side-effects-of-art */
                    if(!jq(".hepB-status").find("input[type='radio']:checked")){
                         jq(".hepB-results").find("input[type$='radio']").attr('disabled', true);
                    }
                    else{
                         jq(".hepB-results").find("input[type$='radio']").attr('disabled', false);
                    }

                    /*enable disable Art adherence on edit */

                    var adherence = jq("#art-adherence").find("input[type='radio']:checked").val();
                    if (adherence == 90157 || adherence == 90158) {
                        jq(".fair-or-poor-art-adherence-reason").find("input[type$='checkbox']").attr('disabled', false);
                        jq(".fair-or-poor-art-adherence-reason").removeClass("html-form-entry-disabled-field");
                    } else {
                        jq(".fair-or-poor-art-adherence-reason").find("input[type$='checkbox']").prop("checked", false);
                        jq(".fair-or-poor-art-adherence-reason").find("input[type$='checkbox']").attr('disabled', true);
                        jq(".fair-or-poor-art-adherence-reason").addClass("html-form-entry-disabled-field");
                    }
                    if (jq("#enable-disable-other-poor-art-adherence-reason").find(':checkbox').prop('checked')) {
                        jq("#other-poor-art-adherence-reason-enabled").find("input[type$='text']").attr("disabled", false);
                        jq("#other-poor-art-adherence-reason-enabled").removeClass("html-form-entry-disabled-field");
                    } else {
                        jq("#other-poor-art-adherence-reason-enabled").find("input[type$='text']").attr("disabled", true);
                        jq("#other-poor-art-adherence-reason-enabled").addClass("html-form-entry-disabled-field");
                    }

                    /* enable art prescription on edit */
                    if (jq("#art-regimen").find("select").find(":selected").val() !== " ") {
                        enable_fields("no-of-art-pills");
                        enable_fields("no-of-art-pills-days");
                        enable_fields("split-regimen");
                    } else {
                        disable_fields("no-of-art-pills");
                        disable_fields("no-of-art-pills-days");
                        disable_fields("split-regimen");
                    }

                    if (jq("#isoniazid").find("input[type='radio']:checked")) {
                        enable_fields("no-of-isoniazid");
                        enable_fields("duration-on-isoniazid");
                    } else {
                        disable_fields("no-of-isoniazid");
                        disable_fields("duration-on-isoniazid");
                    }

                    if ( jq("#is-taking-dapsone").find("input[type='radio']:checked")) {
                        enable_fields("no-of-dapsone-pills");
                        enable_fields("no-of-dapsone-pills-days");
                    } else {
                        disable_fields("no-of-dapsone-pills");
                        disable_fields("no-of-dapsone-pills-days");
                    }

                    if (jq("#vitamin-b6").find("input[type='radio']:checked").val() == "82912") {
                        enable_fields("no-of-vitamin-b6");
                        enable_fields("duration-on-vitamin-b6");
                    } else {
                        disable_fields("no-of-vitamin-b6");
                        disable_fields("duration-on-vitamin-b6");
                    }

                    disable_enable_on_edit_mode("fluconazole-stop-date");
                    disable_enable_on_edit_mode("no-of-fluconazole-pills");
                    disable_enable_on_edit_mode("no-of-fluconazole-pills-days");

                    /* other regimen enable disable on edit*/
                    disable_enable_on_edit_mode("other-regimen");

                    disable_enable_on_edit_mode("other-reason-for-next-appointment");
                   disable_enable_on_edit_mode("99413-target");
                   disable_enable_on_edit_mode("160856");
                   disable_enable_on_edit_mode("159368");
                </ifMode>

                /* enable the edd,emtct,age in months and ANC no. fields in case the client is pregnant */

                jq(".pregnancy").change(function () {
                    if (jq(this).find('#pregnant').find(':checkbox').prop('checked')) {
                        enable_fields("edd");
                        enable_fields("emtct");
                        enable_fields("age-in-months");
                        enable_fields("anc_no");
                    } else {
                        disable_fields("edd");
                        disable_fields("emtct");
                        disable_fields("age-in-months");
                        disable_fields("anc_no");
                    }
                });

                jq(".pregnancy").change(function () {
                    if (jq(this).find('#not-pregnant-not-breast-feeding').find(':checkbox').prop('checked')) {
                        jq("#pregnant").find("input[type$='checkbox']").prop("checked", false);
                        jq("#breast-feeding").find("input[type$='checkbox']").prop("checked", false);
                        disable_fields("edd");
                        disable_fields("emtct");
                        disable_fields("162983");
                        disable_fields("anc_no");
                        disable_fields("162983");
                    }
                });

                jq(".pregnancy").change(function () {
                    if (jq(this).find('#not-pregnant-not-applicable').find(':checkbox').prop('checked')) {
                        jq("#pregnant").find("input[type$='checkbox']").prop("checked", false);
                        jq("#breast-feeding").find("input[type$='checkbox']").prop("checked", false);
                        jq("#not-pregnant-not-breast-feeding").find("input[type$='checkbox']").prop("checked", false);
                        disable_fields("edd");
                        disable_fields("emtct");
                        disable_fields("162983");
                        disable_fields("anc_no");
                    }
                });
                hideContainer("#split_regimen_container");
                jq("#split-regimen").change(function () {
                    if (jq(this).find(':checkbox').prop('checked')) {
                        disable_fields("no-of-art-pills");
                        disable_fields("no-of-art-pills-days");
                        showContainer("#split_regimen_container");

                    }else {
                        enable_fields("no-of-art-pills");
                        enable_fields("no-of-art-pills-days");
                        hideContainer("#split_regimen_container");
                    }
                });

                /*enable disable family planning options*/

                jq("#enable-disable-family-planning-methods").change(function () {
                    if (jq(this).find("input[type='radio']:checked").val() == 90082) {
                        jq(".family-planning-methods").find("input[type$='checkbox']").attr('disabled', false);
                        jq(".family-planning-methods").removeClass("html-form-entry-disabled-field");
                    } else {
                        jq(".family-planning-methods").find("input[type$='checkbox']").attr('disabled', true);
                        jq(".family-planning-methods").find("input[type$='checkbox']").prop("checked", false);
                        jq(".family-planning-methods").addClass("html-form-entry-disabled-field");
                    }
                });



                //enable start date and district number if client is on TbRx
                jq("#tb-status").change(function () {
                    if (jq(this).find("select").find(":selected").val() == "90071" || jq(this).find("select").find(":selected").val() == "165295" || jq(this).find("select").find(":selected").val() == "165296" || jq(this).find("select").find(":selected").val() == "165297" || jq(this).find("select").find(":selected").val() == "165298" || jq(this).find("select").find(":selected").val() == "165299" || jq(this).find("select").find(":selected").val() == "165300" ) {
                        enable_fields("tb-start-date");
                        enable_fields("district-tb-no");
                    } else {
                        disable_fields("tb-start-date");
                        disable_fields("district-tb-no");
                    }
                });


                jq("#tb-status").change(function () {
                    if (jq(this).find("select").find(":selected").val() == "99421") {
                        enable_fields("tb-stop-date");
                    } else {
                        disable_fields("tb-stop-date");
                    }
                });



                jq("#tpt-status").change(function () {
                    if (jq(this).find("select").find(":selected").val() == "90072") {
                        enable_fields("tpt-initiation-date");
                    } else {
                        disable_fields("tpt-initiation-date");
                    }
                });

                jq("#tpt-status").change(function () {
                    if (jq(this).find("select").find(":selected").val() == "160035") {
                        enable_fields("tpt-completion-date");
                    } else {
                        disable_fields("tpt-completion-date");
                    }
                });

                jq("#tpt-status").change(function () {
                    if (jq(this).find("select").find(":selected").val() == "90040") {
                        enable_fields("tpt-side-effects");
                    } else {
                        disable_fields("tpt-side-effects");
                    }
                });

                /*enable disable dapsone prescription*/

                jq("#is-taking-dapsone").change(function () {
                    if (jq(this).find("input[type='radio']:checked").val() == "1065") {
                        enable_fields("no-of-dapsone-pills");
                        enable_fields("no-of-dapsone-pills-days");
                    } else {
                        disable_fields("no-of-dapsone-pills");
                        disable_fields("no-of-dapsone-pills-days");
                    }
                });

                /*enable disable isoniazid prescription*/


                jq("#isoniazid").click(function () {
                    if (jq(this).find("input[type='radio']:checked").val() == "78280") {
                        enable_fields("no-of-isoniazid");
                        enable_fields("duration-on-isoniazid");
                    } else {
                        disable_fields("no-of-isoniazid");
                        disable_fields("duration-on-isoniazid");
                    }
                });

                /*enable disable vitamin-b6 prescription*/


                jq("#vitamin-b6").click(function () {
                    if (jq(this).find("input[type='radio']:checked").val() == "82912") {
                        enable_fields("no-of-vitamin-b6");
                        enable_fields("duration-on-vitamin-b6");
                    } else {
                        disable_fields("no-of-vitamin-b6");
                        disable_fields("duration-on-vitamin-b6");
                    }
                });

                /*disable fluconazole prescription*/



                // enable number of fluconazole stop date if fluconazole start date is defined
                jq("#fluconazole-start-date").change(function () {
                    if (jq(this).find("input[type=hidden]").val() != "") {
                        enable_fields("fluconazole-stop-date");
                        enable_fields("no-of-fluconazole-pills");
                        enable_fields("no-of-fluconazole-pills-days");
                    } else {
                        disable_fields("fluconazole-stop-date");
                        disable_fields("no-of-fluconazole-pills");
                        disable_fields("no-of-fluconazole-pills-days");
                    }
                });

                /* enable or disable other art regimens */

                jq("#art-regimen").change(function () {
                    if (jq(this).find("select").find(":selected").val() == "90002") {
                        enable_fields("other-regimen");
                    } else {
                        disable_fields("other-regimen");
                    }
                });



                /* enable art prescription */
                jq("#art-regimen").change(function () {
                    if (jq(this).find("select").find(":selected").val() !== " ") {
                        enable_fields("no-of-art-pills");
                        enable_fields("no-of-art-pills-days");
                        enable_fields("split-regimen");
                    } else {
                        disable_fields("no-of-art-pills");
                        disable_fields("no-of-art-pills-days");
                        disable_fields("split-regimen");
                    }
                });

                /* enable viral load copies field */
                jq("#viral-load-results-qualitative").change(function () {
                    var viral_load_status = getValue('viral-load-results-qualitative.value');
                    if (viral_load_status == "") {
                        jq("#viral-load-status").hide();
                    }

                    if (viral_load_status == 1301) {
                        /* Detected */
                    <ifMode mode = "ENTER" >
                            setValue('viral-load-results-copies.value', '');
                    </ifMode>

                        var viral_load_copies = getValue('viral-load-results-copies.value');
                        if (viral_load_copies == 1) {
                            jq("#viral-load-status").hide();
                            setValue('viral-load-results-copies.value', '');
                        }
                    }
                    if (viral_load_status == 1306) {
                        /* Not Detected */
                        jq("#viral-load-status").hide();
                        setValue('viral-load-results-copies.value', 1);
                    }
                });

                jq("#viral-load-results-copies").change(function () {
                    previousVl = jq("#viral-load-results-copies").find("input").val();
                    DSDMStabilityCheck();
                });

                // trigger a change when the form loads
                jq("#viral-load-results-qualitative").change();

                /*determine viral load status*/
                jq("#viral-load-results-copies").change(function () {
                    jq("#viral-load-status").show();
                    var vl_copies = jq(this).find("input").val();
                    if (vl_copies == " " || vl_copies == 0) {
                        jq("#viral-load-status").hide();
                    }
                    if (vl_copies &lt; 1000) {
                        jq("#viral-load-status").html("Suppressed");
                    } else if (vl_copies &gt;= 1000) {
                        jq("#viral-load-status").html("Non-suppressed");
                    } else {
                        jq("#viral-load-status").hide();
                    }
                });

                /*enable disable Art adherence*/

                jq("#art-adherence").change(function () {
                    var adherence = jq(this).find("input[type='radio']:checked").val();
                    if (adherence == 90157 || adherence == 90158) {
                        jq(".fair-or-poor-art-adherence-reason").find("input[type$='checkbox']").attr('disabled', false);
                        jq(".fair-or-poor-art-adherence-reason").removeClass("html-form-entry-disabled-field");
                    } else {
                        jq(".fair-or-poor-art-adherence-reason").find("input[type$='checkbox']").prop("checked", false);
                        jq(".fair-or-poor-art-adherence-reason").find("input[type$='checkbox']").attr('disabled', true);
                        jq(".fair-or-poor-art-adherence-reason").addClass("html-form-entry-disabled-field");
                    }
                });

                /*enable disable Hepatitis B status*/



                jq(".hepB-status").change(function () {
                    var hepStatus = jq(this).find("input[type='radio']:checked").val();
                    if (hepStatus == 159971) {
                        jq(".hepB-results").find("input[type$='radio']").attr('disabled', false);
                    } else {
                        jq(".hepB-results").find("input[type$='radio']").attr('disabled', true);
                    }
                });

                jq("#bmi").find("input[type$='text']").attr('disabled', true);

                //This function checks if patient is stable or unstable given the patient`s viral load
                function DSDMStabilityCheck() {

                    stableArray = [];
                    instabilityCause = "";

                    if (previousVl !== "" &amp;&amp; previousVl &lt;= 1000) {
                        stableArray.push(true);
                    } else {
                        stableArray.push(false);
                        instabilityCause = instabilityCause + "Viral Load is Not Suppressed \n ";
                    }

                    /* Third Line*/
                    if (onThirdLine !== "true") {
                        stableArray.push(true);
                    } else {
                        stableArray.push(false);
                        instabilityCause += "Current regimen is a third line regimen \n "
                    }

                    /* Adherence Check*/
                    if (adherence.length &lt;= 0 || adherence.trim().includes("POOR")) {
                        stableArray.push(false);
                        instabilityCause += "Adherence is not Good \n "
                    } else {
                        stableArray.push(true);
                    }

                    /* Clinic staging */
                    if (clinicStaging === "90033" || clinicStaging === "90034" || clinicStaging === "90293" || clinicStaging === "90294") {
                        stableArray.push(true);
                    } else {
                        stableArray.push(false);
                        instabilityCause += "Clinic stage is neither 1 or 2 \n";
                    }
                    var pageCurrentRegimen = jq("#art-regimen").find("select").find(":selected").val();
                    var pageEncounterDate = jq("#encounterDate").find("input[type=hidden]").val();
                    var dsdmRegimenCoceptsIds = "164976,164977,164978,164979";

                    if (currentRegimen !== "" &amp;&amp; (currentRegimen === pageCurrentRegimen || dsdmRegimenCoceptsIds.trim().includes(pageCurrentRegimen)) &amp;&amp; periodBetweenDates(new Date(pageEncounterDate), new Date(regimenStartedDate)) &gt; 12) {

                        stableArray.push(true);
                    } else {
                        stableArray.push(false);
                        instabilityCause += "Patient has not spent more than 12 moths on current Regiment \n "
                    }

                    if (sputumValue !== "" &amp;&amp; sputumValue !== "664" &amp;&amp; periodBetweenDates(new Date(jq("#encounterDate").find("input[type=hidden]").val()), new Date(teatmentStartDate)) &lt; 2) {
                        stableArray.push(false);
                        instabilityCause += "Patient has not been on treatment for TB for at least 2 months"
                    } else {
                        stableArray.push(true);
                    }
                    instabilityCause.trim().replace()

                    if (stableArray.indexOf(false) != -1) {
                        jq("#patient-categorization select").val("90004");
                    } else {
                        jq("#patient-categorization select").val("90003");
                    }
                }

                /* enabling and disabling other signs and symptoms */

                jq("#enable-disable-signs-and-symptoms").change(function () {
                    if (jq(this).find(':checkbox').prop('checked')) {
                         enable_fields("signs-and-symptoms-enabled");
                    } else {
                        disable_fields("signs-and-symptoms-enabled");
                    }
                });

                /* enabling and disabling other side effects of art*/
                jq("#enable-disable-side-effects-of-art").change(function () {
                    if (jq('#enable-disable-side-effects-of-art').find(':checkbox').prop('checked')) {
                        enable_fields("side-effects-of-art-enabled");
                    } else {
                         disable_fields("side-effects-of-art-enabled");
                    }
                });



                jq("#enable-disable-other-poor-art-adherence-reason").change(function () {
                    if (jq(this).find(':checkbox').prop('checked')) {
                        jq("#other-poor-art-adherence-reason-enabled").find("input[type$='text']").attr("disabled", false);
                        jq("#other-poor-art-adherence-reason-enabled").removeClass("html-form-entry-disabled-field");
                    } else {
                        jq("#other-poor-art-adherence-reason-enabled").find("input[type$='text']").attr("disabled", true);
                        jq("#other-poor-art-adherence-reason-enabled").addClass("html-form-entry-disabled-field");
                    }
                });

                jq("#encounter-card-poc").show();
                jq("#investigation-reports-poc").hide();
                jq("#diagnosis-poc").hide();
                jq("#medication-poc").hide();
                jq("#programing-dsdm-poc").hide();
                jq("#next-course-of-action").hide();

                jq("#clinical-encounter-menu-poc").click(function () {

                    jq("#encounter-card-poc").show();
                    jq("#investigation-reports-poc").hide();
                    jq("#diagnosis-poc").hide();
                    jq("#medication-poc").hide();
                    jq("#programing-dsdm-poc").hide();
                    jq("#next-course-of-action").hide();

                });

                jq("#investigations-menu-poc").click(function () {

                    jq("#encounter-card-poc").hide();
                    jq("#investigation-reports-poc").show();
                    jq("#diagnosis-poc").hide();
                    jq("#medication-poc").hide();
                    jq("#programing-dsdm-poc").hide();
                    jq("#next-course-of-action").hide();

                });

                jq("#diagnosis-menu-poc").click(function () {

                    jq("#encounter-card-poc").hide();
                    jq("#investigation-reports-poc").hide();
                    jq("#diagnosis-poc").show();
                    jq("#medication-poc").hide();
                    jq("#programing-dsdm-poc").hide();
                    jq("#next-course-of-action").hide();

                });

                jq("#medication-menu-poc").click(function () {

                    jq("#encounter-card-poc").hide();
                    jq("#investigation-reports-poc").hide();
                    jq("#diagnosis-poc").hide();
                    jq("#medication-poc").show();
                    jq("#programing-dsdm-poc").hide();
                    jq("#next-course-of-action").hide();

                });

                jq("#dsdm-menu-poc").click(function () {

                    jq("#encounter-card-poc").hide();
                    jq("#investigation-reports-poc").hide();
                    jq("#diagnosis-poc").hide();
                    jq("#medication-poc").hide();
                    jq("#programing-dsdm-poc").show();
                    jq("#next-course-of-action").hide();
                });

                jq("#course-of-action-menu-poc").click(function () {

                    jq("#encounter-card-poc").hide();
                    jq("#investigation-reports-poc").hide();
                    jq("#diagnosis-poc").hide();
                    jq("#medication-poc").hide();
                    jq("#programing-dsdm-poc").hide();
                    jq("#next-course-of-action").show();

                });

            });

            beforeSubmit.push(function () {
                <!-- clear the previous errors -->
                setValue('returndate.error', '');
                setValue('viral-load-results-copies.error', '');
                setValue('date-viral-load-taken.error', '');

            <restrictByRole exclude="Data Clerk,System Developer,Organizational: System Administrator">
                setValue('no-of-art-pills.error','');
                setValue('isoniazid-pills.error','');
                setValue('vitamin-b6-pills.error','');
                setValue('160856.error','');
                setValue('fluconazole-pills.error','');
                setValue('other-meds-quantity.error','');
            </restrictByRole>


                var encounterDate = new Date((getValue('encounterDate.value')));
                var appointment = new Date((getValue('returndate.value')));

                if(getValue('provider.value')==""){
                     jq().toastmessage('showErrorToast', "Attending clinician is required");
                 }

                if (encounterDate &gt;= appointment) {
                    getField('returndate.error').html('The return date must be after the date of this visit ' +
                        formatDateForDisplay(encounterDate)).show();
                    jq().toastmessage('showErrorToast', "The return date must be after the date of this visit");
                    return false;

                }

                <!-- Check that the return date is before the transfer out date only if there is a transfer out date -->
                if (jq('#transfer_out_date_id').html().replace(/\s+/, "").length > 0) {
                    var transfer_out_date_id = new Date(jq('#transfer_out_date_id').html());
                    if (appointment &gt;= transfer_out_date_id) {
                        getField('returndate.error').html('The return date must be before the transfer out date of ' +
                            formatDateForDisplay(transfer_out_date_id)).show();
                    jq().toastmessage('showErrorToast', "The return date must be before the transfer out date");
                        return false;
                    }
                    return false;
                }

                var viral_load_qualitative = getValue('viral-load-results-qualitative.value');
                var date_viral_load_taken = getValue('date-viral-load-taken.value');
                /* The date that the viral load was taken is required if a qualitative result is selected */
                if (viral_load_qualitative != "") {
                    if (date_viral_load_taken == "") {
                        getField('date-viral-load-taken.error').html('Please enter the date when the viral load sample was taken').show();
                        jq().toastmessage('showErrorToast', 'Please enter the date when the viral load sample was taken');
                        return false;
                    }
                }

                /** The date the viral load was taken cannot be after the encounter date */
                if (date_viral_load_taken != "") {
                    if (encounterDate &lt; date_viral_load_taken) {
                        getField('date-viral-load-taken.error').html('The date the viral load sample was taken cannot be after the date of this visit ' + encounterDate).show();
                        jq().toastmessage('showErrorToast', "The date the viral load sample was taken cannot be after the date of this visit");
                        return false;
                    }
                }

                /* If the viral load is detected, the number of copies must be greater than 20 which is the lowest detectable level for a machine */
                if ((viral_load_qualitative == 1301) &amp;&amp; (getValue('viral-load-results-copies.value') &lt; 20)) {
                    getField('viral-load-results-copies.error').html('Please enter the number of virus copies per ml. the minimum number of copies is 20').show();
                    jq().toastmessage('showErrorToast', "Please enter the number of virus copies per ml. the minimum number of copies is 20");
                    return false;
                }


                /* if DSDM is not FBIM or FTR or Empty and patient is not stable should not save.*/
                if (jq("#patient-categorization").find("select").find(":selected").val() !== "90003" &amp;&amp; (jq("#165143").find("select").find(":selected").val() !== "165138" &amp;&amp; jq("#165143").find("select").find(":selected").val() !== "165140" &amp;&amp; jq("#165143").find("select").find(":selected").val() !== "")) {
                    getField('165143.error').html('Patient Not Stable due to ' + instabilityCause + '. \n Only Stable Patients can be enrolled in ' + jq("#165143").find("select").find(":selected").text()).show();

                    jq().toastmessage('showErrorToast', " Patient Not Stable " + instabilityCause + ". \n Only Stable Patients can be enrolled in " + jq("#165143").find("select").find(":selected").text());
                    return false;
                }

                <!--Not to exceed number of booking for a specific return date. Default is 100 clients-->
                <!-- formatting date String from YYYY-MM-DD to DD/MM/YYYY to pass in the Url-->
                var selectedDate = getValue('returndate.value');

                var formattedDate = changeFieldDateToJavascriptDate(selectedDate);
                var appointmentCountURL = window.location.origin + '/' + OPENMRS_CONTEXT_PATH + '/ws/rest/v1/ugandaemr/appointmentcount?nextAppointmentDate=' + formattedDate.replace(/['"]+/g, '') + '&amp;encounterType=8d5b2be0-c2cc-11de-8d13-0010c6dffd0f';

                isValid = true;
                var maxNumberOfBooked =  jq("#numberOfPatients").html();

                if(getValue('returndate.value')!=="")
                {
                jq.ajax({
                     type: 'GET',
                     dataType: 'json',
                     url: appointmentCountURL,
                     async:false,
                     success: function(response){
                         if(response.appointmentcount &gt;= maxNumberOfBooked){
                            getField('returndate.error').html('The patient cannot be scheduled on ' + formattedDate + ' because the limit of ' + maxNumberOfBooked + ' has been reached').show();
                            jq().toastmessage('showErrorToast', 'The patient cannot be scheduled on ' + formattedDate + ' because the limit of ' + maxNumberOfBooked + ' has been reached');
                             isValid = false;
                         }
                     },
                    error: function(jqXHR, textStatus, errorThrown) {
                           getField('returndate.error').html('Unable to determine the number of patients scheduled on ' + formattedDate + ' due to ' + textStatus ).show();
                            jq().toastmessage('showErrorToast', 'Unable to determine the number of patients scheduled on ' + formattedDate + ' due to ' + textStatus );
                            isValid = false;
                    }
                });
                 <!--Not to book on a public holiday-->
                var publicHolidayURL = window.location.origin + '/' + OPENMRS_CONTEXT_PATH + '/ws/rest/v1/ugandaemr/publicHoliday?date=' + formattedDate ;

                jq.ajax({
                     type: 'GET',
                     url: publicHolidayURL,
                     async:false,
                     success: function(response){
                         if(response.results.length){
                            getField('returndate.error').html('The patient cannot be scheduled on ' + formattedDate + ' which is a public holiday, ' + response.results[0].name).show();
                            jq().toastmessage('showErrorToast', 'The patient cannot be scheduled on ' + formattedDate + ' which is a public holiday, ' + response.results[0].name);
                             isValid = false;
                         }
                     },
                    error: function(jqXHR, textStatus, errorThrown) {
                          getField('returndate.error').html('Unable to determine if ' + formattedDate + ' is a public Holiday').show();
                            jq().toastmessage('showErrorToast', 'Unable to determine if ' + formattedDate + ' is a public Holiday');
                            isValid  = false;
                        }
                });

                // check the appointment dates
                return isValid;
                }

            <restrictByRole exclude="Data Clerk,System Developer,Organizational: System Administrator">
                if (getValue('art-regimen.value') != "" &amp;&amp; getValue('no-of-art-pills.value') == "") {
                     getField('no-of-art-pills.error').html('No of ' + jq("#art-regimen").find(":selected").text() + ' pills required').show();
                    return false;
                }

                if (getValue('isoniazid-trigger.value') != "" &amp;&amp; getValue('isoniazid-pills.value') == "") {
                    getField('isoniazid-pills.error').html('No of isoniazid pills required').show();
                    return false;
                }

                if (getValue('vitamin-b6-trigger.value') != "" &amp;&amp; getValue('vitamin-b6-pills.value') == "") {
                    getField('vitamin-b6-pills.error').html('No. of Vitamin B6 pills required').show();
                    return false;
                }

<!--                checking whether no of pills for cotrimaxzole  prescribed are entered-->
                if (getValue('99413-target.value') != "" &amp;&amp; getValue('160856.value') == "") {
                    getField('160856.error').html('No. of Dapsone/Cotrimoxazole pills  required').show();
                    return false;
                }

                if (getValue('fluconazole-trigger.value') != "" &amp;&amp; getValue('fluconazole-pills.value') == "") {
                    getField('fluconazole-pills.error').html('No. of fluconazole pills required').show();
                    return false;
                }

                if (getValue('other-meds-trigger.value') != "" &amp;&amp; getValue('other-meds-quantity.value') == "") {
                    getField('other-meds-quantity.error').html('Quantity of ' + getValue('other-meds-trigger.value') + ' required').show();
                    return false;
                }
            </restrictByRole>

                return true;
            });

        }

        <!-- only show BMI if patient is more than 5 years old (on the encounterDate) -->
        <includeIf velocityTest = "$patient.getAge($encounter.getEncounterDatetime()) > 5">

        var calculateBmi = function (wt, ht) {
                var bmi = null
                if (wt &amp;&amp; ht) {
                    bmi = wt / ((ht / 100) * (ht / 100));
                }
                return bmi;
            }

            <ifMode mode = "ENTER" >

        //functions to handle updating the bmi when in ENTER mode
        var updateBmi = function () {
            var wt = htmlForm.getValueIfLegal('weight.value');
            var ht = htmlForm.getValueIfLegal('height.value');

            var bmi = calculateBmi(wt, ht);

            if (bmi == null || isNaN(bmi)) {
                jq('#calculated-bmi-wrapper').hide();
            } else {
                jq('#no-calculated-bmi').hide();
                jq('#calculated-bmi-wrapper').show();
                jq('#calculated-bmi').html(bmi.toFixed(1));
                jq('#hidden-calculated-bmi').val(bmi.toFixed(1));
            }
        };

        jq(function () {
            jq('#calculated-bmi-wrapper').hide();
            getField('weight.value').change(updateBmi)
            getField('height.value').change(updateBmi);
            updateBmi();
        });

        </ifMode>

        // set the blood pressure fields as "expected"
        jq('#bp_systolic > input').addClass('expected');
        jq('#bp_diastolic > input').addClass('expected');

        <ifMode mode = "VIEW" >
            // handle displaying the bmi when in VIEW mode
            // we have to iterate through in case there are multiple vitals forms
            // displayed on a single page

            jq('htmlform').each(function (index, form) {
                jq(form).find('#calculated-bmi-continue').hide();
                jq(form).find('#no-calculated-bmi').hide();

                var wt = jq(form).find('#weight').find('.value').text();
                var ht = jq(form).find('#height').find('.value').text();

                var bmi = calculateBmi(wt, ht);

                if (bmi != null &amp;&amp; !isNaN(bmi)) {
                    jq(form).find('#calculated-bmi-wrapper').show();
                    jq(form).find('#calculated-bmi').html(bmi.toFixed(1));
                    jq(form).find('#hidden-calculated-bmi').val(bmi.toFixed(1));
                }
            });


        </ifMode>


        </includeIf>

    </script>
    <restrictByRole exclude="Organizational: System Administrator">
        <div class="hidden">
            <uiInclude provider="aijar" fragment="patientStability"/>
        </div>
    </restrictByRole>
    <restrictByRole include="Organizational: System Administrator">
        <script>
            jq(function () {
                jq().toastmessage('showErrorToast', "Your account has a role Organizational: System Administrator which is prohibited from data entry");
                alert('Your account has a role Organizational: System Administrator which is prohibited from data entry');

                var queryParameters = {}, queryString = location.search.substring(1),
                    re = /([^&amp;=]+)=([^&amp;]*)/g, m;
                // Creates a map with the query string parameters
                while (m = re.exec(queryString)) {
                    queryParameters[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
                }''
                location.href = window.location.protocol + "//" + window.location.host +
                    '/' + OPENMRS_CONTEXT_PATH + '/coreapps/clinicianfacing/patient.page?patientId='
                    + queryParameters['patientId']; // Causes page to reload
            });
        </script>
    </restrictByRole>

    <!-- This section contains lookup tags that pick data from other forms-->

    <lookup complexExpression="#set($art_start_regimen='null') #set($other_art_start_regimen='null') #set($art_transfer_regimen='null') #set($other_art_transfer_regimen='null')"/>

    <lookup complexExpression="#set($first_second_line_regimen='null') #set($other_first_second_line_regimen='null')"/>

    <lookup complexExpression="#set($third_line_regimen='null') #set($other_third_line_regimen='null')"/>

    <span class="hidden" id="artStartRegimen">
        <lookup
                complexExpression="#set($art_start_regimen=($fn.latestObs('99061').valueCoded))$art_start_regimen"/>
    </span>

    <span class="hidden" id="otherArtStartRegimen">
        <lookup
                complexExpression="#set($other_art_start_regimen=($fn.latestObs('99268').valueText))$other_art_start_regimen"/>
    </span>

    <span class="hidden" id="artTransferRegimen">
        <lookup
                complexExpression="#set($art_transfer_regimen=$fn.latestObs('99064').valueCoded)$art_transfer_regimen"/>
    </span>

    <span class="hidden" id="otherArtTransferRegimen">
        <lookup
                complexExpression="#set($other_art_transfer_regimen=$fn.latestObs('99269').valueText)$other_art_transfer_regimen"/>
    </span>

    <span class="hidden" id="firstSecondLineRegimen">
        <lookup
                complexExpression="#foreach($first_second_line_regimen in $fn.allObs(90315)) $first_second_line_regimen.valueCoded #end"/>
    </span>

    <span class="hidden" id="otherFirstSecondLineRegimen">
        <lookup
                complexExpression="#foreach($other_first_second_line_regimen in $fn.allObs(99146)) $other_first_second_line_regimen.valueText #end"/>
    </span>


    <span class="hidden" id="thirdLineRegimen">
        <lookup
                complexExpression="#foreach($third_line_regimen in $fn.allObs(162990)) $first_second_line_regimen.valueCoded #end"/>
    </span>

    <span class="hidden" id="otherThirdLineRegimen">
        <lookup
                complexExpression="#foreach($other_third_line_regimen in $fn.allObs(162989)) $other_first_second_line_regimen.valueText #end"/>
    </span>


     <!-- This section contains lookup tags that pick data from other forms -->

    <lookup complexExpression="#set($art_start_regimen='null') #set($other_art_start_regimen='null') #set($art_transfer_regimen='null') #set($other_art_transfer_regimen='null')"/>

    <lookup complexExpression="#set($first_second_line_regimen='null') #set($other_first_second_line_regimen='null')"/>

    <lookup complexExpression="#set($third_line_regimen='null') #set($other_third_line_regimen='null')"/>

    <span class="hidden" id="artStartRegimen">
        <lookup
                complexExpression="#set($art_start_regimen=($fn.latestObs('99061').valueCoded))$art_start_regimen"/>
    </span>

    <span class="hidden" id="otherArtStartRegimen">
        <lookup
                complexExpression="#set($other_art_start_regimen=($fn.latestObs('99268').valueText))$other_art_start_regimen"/>
    </span>

    <span class="hidden" id="artTransferRegimen">
        <lookup
                complexExpression="#set($art_transfer_regimen=$fn.latestObs('99064').valueCoded)$art_transfer_regimen"/>
    </span>

    <span class="hidden" id="otherArtTransferRegimen">
        <lookup
                complexExpression="#set($other_art_transfer_regimen=$fn.latestObs('99269').valueText)$other_art_transfer_regimen"/>
    </span>

    <span class="hidden" id="firstSecondLineRegimen">
        <lookup
                complexExpression="#foreach($first_second_line_regimen in $fn.allObs(90315)) $first_second_line_regimen.valueCoded #end"/>
    </span>

    <span class="hidden" id="otherFirstSecondLineRegimen">
        <lookup
                complexExpression="#foreach($other_first_second_line_regimen in $fn.allObs(99146)) $other_first_second_line_regimen.valueText #end"/>
    </span>


    <span class="hidden" id="thirdLineRegimen">
        <lookup
                complexExpression="#foreach($third_line_regimen in $fn.allObs(162990)) $first_second_line_regimen.valueCoded #end"/>
    </span>

    <span class="hidden" id="otherThirdLineRegimen">
        <lookup
                complexExpression="#foreach($other_third_line_regimen in $fn.allObs(162989)) $other_first_second_line_regimen.valueText #end"/>
    </span>
    <span class="hidden" id="numberOfPatients"><lookup expression="fn.globalProperty('ugandaemr.maximumPatientsPerDay')"/></span>

    <restrictByRole exclude="HIV Clinic">
        <div>
            <div class="row">
                <div class="col-md-6">
                    <h1>HMIS HIV 003:HIV Care/ART Card - Clinical Assessment</h1>
                </div>
                <div class="col-md-5"></div>
                <div class="col-md-1 submitButton">
                    <postSubmissionAction
                            class="org.openmrs.module.aijar.htmlformentry.DSDSProgramSubmissionAction"/>
                    <submit class="confirm" submitLabel="Save"/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs nav-fill">
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#appointment-vitals-nutrition">
                                        Appointment/ Vitals/ Nutrition Assessment
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#pregnancy-fp">
                                        Pregnancy/ Family Planning
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#tb-treatment-clinical-assessment">
                                        TB Treatment/ Clinical Assessment
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#medication">Medication</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#investigations">
                                        Tests/Investigations and DSDM
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content">
                                <div class="tab-pane active" id="appointment-vitals-nutrition">
                                    <section>
                                        <div class="card">
                                            <div class="card-header">Appointment</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-3" id="visit-date">
                                                        <label>Visit Date</label>
                                                        <encounterDate default="today"
                                                                       disallowMultipleEncountersOnDate="block"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <excludeIf velocityTest="$patient.person.dead ==true">
                                                            <lookup complexExpression="#set($transfer_out_date = '')"/>
                                                            <ifMode mode="ENTER">
                                                                <span id="transfer_out_date_id" class="hidden">
                                                                    <lookup
                                                                            complexExpression="#set($transfer_out_date=($fn.latestObs('99165').valueDatetime)) #set($lost_to_follow_date=$fn.latestObs('99165').valueDatetime) #set($transfer_out=$fn.latestObs('90306').valueCoded.name) $transfer_out_date"/>
                                                                </span>
                                                                <includeIf velocityTest="$transfer_out=='YES'">
                                                                    <label>Return date</label>
                                                                    <obs id="returndate" conceptId="5096"
                                                                         allowFutureDates="true"/>
                                                                </includeIf>
                                                                <includeIf velocityTest="$transfer_out!='YES'">
                                                                    <label>Return date</label>
                                                                    <obs id="returndate" conceptId="5096"
                                                                         required="required" allowFutureDates="true"/>
                                                                </includeIf>
                                                            </ifMode>
                                                            <ifMode mode="EDIT">
                                                                <span id="transfer_out_date_id" class="hidden">
                                                                    <lookup
                                                                            complexExpression="#set($transfer_out_date=($fn.latestObs('99165').valueDatetime)) #set($lost_to_follow_date=$fn.latestObs('99165').valueDatetime) #set($transfer_out=$fn.latestObs('90306').valueCoded.name) $transfer_out_date"/>
                                                                </span>
                                                                <includeIf velocityTest="$transfer_out=='YES'">
                                                                    <label>Return date</label>
                                                                    <obs id="returndate" conceptId="5096"
                                                                         allowFutureDates="true"/>
                                                                </includeIf>
                                                                <includeIf velocityTest="$transfer_out!='YES'">
                                                                    <label>Return date</label>
                                                                    <obs id="returndate" conceptId="5096"
                                                                         required="required" allowFutureDates="true"/>
                                                                </includeIf>
                                                            </ifMode>
                                                        </excludeIf>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <span class="">
                                                            <label>Reasons for next appointment</label>
                                                            <obs id="reason-for-next-appointment" conceptId="160288"
                                                                 answerConceptIds="164968,164972,164970,856,5497,163153,164971,164973,99324,164974,90012,903,5484,90002"
                                                                 answerLabels="1. ART Initiation, 2. ART Refill, 3. ART Regimen Switch/ Substitution, 4. Viral Load, 5. CD4, 6. IAC, 7. T.B Drug Refill,8. T.B Follow up,
                                                             9. ANC,10. EID,11. PMTCT, 12. Hypertension/ Diabetes, 13. Nutrition,14. Other Specify"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>Other Reason for next appointment</label>
                                                        <obs id="other-reason-for-next-appointment" conceptId="164975"/>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <obs conceptId="90069" labelText="Visit on Schedule"
                                                             style="checkbox"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                    <label><span class="required">*</span>Attending Clinician</label>
                                                        <encounterProvider role="Provider" style="autocomplete" id="provider"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">Vital Signs</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-2">
                                                        <label>Temperature (c)</label>
                                                        <obs conceptId="CIEL:5088" id="temperature"/>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label>Respiratory Rate (/min)</label>
                                                        <obs conceptId="CIEL:5242" id="respiratory_rate"/>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label>Heart Rate (/min)</label>
                                                        <obs conceptId="CIEL:5087" id="heart_rate"/>
                                                    </div>
                                                    <label>Blood Pressure</label>
                                                    <div class="col-md-1">
                                                        <label>Systolic</label>
                                                        <obs conceptId="CIEL:5085" id="bp_systolic"/>
                                                    </div>
                                                    <div class="col-md-1">
                                                        <label>Diastolic</label>
                                                        <obs conceptId="CIEL:5086" id="bp_diastolic"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">Nutrition Assessment</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <label>Weight (kg)</label>
                                                        <obs conceptId="CIEL:5089" id="weight"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>Ht/ Length (cm)</label>
                                                        <obs conceptId="CIEL:5090" id="height"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <!-- only show BMI if patient is more than 5 years old (on the encounterDate) -->
                                                        <includeIf
                                                                velocityTest="$patient.getAge($encounter.getEncounterDatetime()) > 5">
                                                            <label>BMI (Calculated)</label>
                                                            <span id="calculated-bmi-wrapper">
                                                                <ifMode mode="VIEW" include="false">
                                                                    <span id='calculated-bmi'></span>
                                                                </ifMode>
                                                            </span>
                                                            <p id="calculated-bmi-continue">
                                                                <input type="hidden" name="focus-in-bmi-question"
                                                                       id="hidden-calculated-bmi"/>
                                                            </p>

                                                        </includeIf>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <label>MUAC Score (cm)</label>
                                                        <obs conceptId="CIEL:1343" id="1343"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <span class="muac">
                                                            <includeIf velocityTest="$patient.age &lt; 5">
                                                                <label>MUAC Color Code</label>
                                                                <obs id="99030" conceptId="99030"
                                                                     answerConceptIds="99028,99029,99027"
                                                                     answerLabels="Red &lt; 11.5cm, Yellow 11.5cm - &lt;12.5cm,Green &gt;= 12.5cm"/>
                                                            </includeIf>
                                                            <includeIf
                                                                    velocityTest="$patient.age &lt; 10 &amp;&amp; $patient.age &gt;=5">
                                                                <label>MUAC Color Code</label>
                                                                <obs id="99030" conceptId="99030"
                                                                     answerConceptIds="99028,99029,99027"
                                                                     answerLabels="Red &lt; 13.5cm,Yellow 13.5cm - &lt;14.5cm,Green &gt;=14.5cm"/>
                                                            </includeIf>
                                                            <includeIf
                                                                    velocityTest="$patient.age &lt; 18 &amp;&amp; $patient.age &gt;=10">
                                                                <label>MUAC Color Code</label>
                                                                <obs id="99030" conceptId="99030"
                                                                     answerConceptIds="99028,99029,99027"
                                                                     answerLabels="Red &lt; 16.5cm, Yellow 16.5cm - &lt;19.0cm,Green &gt;=19.0cm"/>
                                                            </includeIf>
                                                            <includeIf velocityTest="$patient.age &gt;=18">
                                                                <label>MUAC Color Code</label>
                                                                <obs id="99030" conceptId="99030"
                                                                     answerConceptIds="99028,99029,99027"
                                                                     answerLabels="Red &lt;19.0cm , Yellow 19.0cm - &lt;22.0cm,Green &gt;=22.0cm"/>
                                                            </includeIf>
                                                        </span>
                                                    </div>
                                                    <excludeIf velocityTest="$patient.age &gt; 11">
                                                        <div class="col-md-3">
                                                            <label>Z-Scores</label>
                                                            <obs conceptId="99800"
                                                                 answerConceptIds="99803,99804,99805,99806,99807"
                                                                 answerLabels="&#60;-3,-3_&#60;-1,-1_1,&#62;1_3,&#62;3"/>
                                                        </div>
                                                    </excludeIf>
                                                    <div class="col-md-3">
                                                        <label>Nutrition Status</label>
                                                        <obs conceptId="165050" class="long-value-select"
                                                             answerConceptIds="1115, 99271, 99272, 99273, 5277"
                                                             answerLabels="N - Normal, MAM - Moderate Acute Malnutrition, SAM - Severe Acute Malnutrition,
                                                         SAMO - Severe Acute Malnutrition with Oedema, O - Overweight/Obese"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>Nutrition Support</label>
                                                        <obs conceptId="99054" class="long-value-select"
                                                             answerConceptIds="99053,99050,99051,99052"
                                                             answerLabels="TF - Therapeutic Feeding (F75 F100 RUTF), SF - Supplementary Feeding,
                                                         IYCF - Infant and Young Child Feeding Counselling ( &lt; 2yrs), NC - Nutrition Counselling only (if &gt; 2yrs)"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                </div>

                                <div class="tab-pane" id="pregnancy-fp">
                                    <section>
                                        <excludeIf velocityTest="$patient.gender =='M' || $patient.age &lt; 9">
                                            <div class="card">
                                                <div class="card-header">Pregnancy</div>
                                                <div class="card-body">
                                                    <div class="row horizontal">
                                                        <div class="col-md-7">
                                                            <span class="pregnancy">
                                                                <obs conceptId="90041" answerConceptId="1065"
                                                                     answerLabel="P - Pregnant" id="pregnant"/>
                                                                <obs conceptId="90041" answerConceptId="99601"
                                                                     answerLabel="BF - Breast Feeding"
                                                                     id="breast-feeding"/>
                                                                <obs conceptId="90041" answerConceptId="1066"
                                                                     answerLabel="NPB - Not pregnant or not breast feeding"
                                                                     id="not-pregnant-not-breast-feeding"/>
                                                                <obs conceptId="90041" answerConceptId="1175"
                                                                     answerLabel="NA - Not Applicable"
                                                                     id="not-pregnant-not-applicable"/>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-1">
                                                            <label>EDD</label>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <obs id="edd" conceptId="5596" allowFutureDates="true"/>
                                                        </div>
                                                        <div class="col-md-1"></div>
                                                        <label>EMTCT</label>
                                                        <div class="col-md-2">
                                                            <obs id="emtct" conceptId="90012"
                                                                 answerConceptIds="90003,90004"
                                                                 answerLabels="Yes,No" class="horizontal"
                                                                 style="radio"/>
                                                        </div>
                                                        <label>Age in months</label>
                                                        <div class="col-md-2">
                                                            <obs id="age-in-months" conceptId="162983"/>
                                                        </div>
                                                        <label>ANC No.</label>
                                                        <div class="col-md-2">
                                                            <span id="anc_no">
                                                                <patient field="identifier"
                                                                         identifierTypeId="b0cc255e-ef57-4266-839e-0df7f5099eb9"
                                                                         required="false"/>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </excludeIf>
                                        <div class="card">
                                            <div class="card-header">Family Planning</div>
                                            <div class="card-body">
                                                <excludeIf velocityTest="$patient.age &lt; 9">
                                                    <div class="row">
                                                        <div class="col-md-2">
                                                            <label>Is on Family Planning ?</label>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <obs id="enable-disable-family-planning-methods" class="horizontal"
                                                                 conceptId="90238"
                                                                 answerConceptIds="90082,90081" answerLabels="Yes,No"
                                                                 style="radio"/>
                                                        </div>
                                                    </div>
                                                    <label>Family Planning Method</label>
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <span class="family-planning-methods">
                                                                <obs conceptId="374" answerConceptId="190"
                                                                     answerLabel="1 - Condoms"/>
                                                                <excludeIf velocityTest="$patient.gender =='M' ">
                                                                    <obs conceptId="374" answerConceptId="5278"
                                                                         answerLabel="5 - Diaphram/Cervical Cap"/>
                                                                </excludeIf>
                                                            </span>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <span class="family-planning-methods">
                                                                <excludeIf velocityTest="$patient.gender =='M' ">
                                                                    <obs conceptId="374" answerConceptId="780"
                                                                         answerLabel="2 - Oral Contraceptive pills"/>
                                                                    <obs conceptId="374" answerConceptId="5275"
                                                                         answerLabel="6 - Intra uterine device (IUD)"/>
                                                                </excludeIf>
                                                                <excludeIf velocityTest="$patient.gender =='F' ">
                                                                    <obs conceptId="374" answerConceptId="99265"
                                                                         answerLabel="2 - Vasectomy/Tubal ligation"/>
                                                                </excludeIf>
                                                            </span>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <span class="family-planning-methods">
                                                                <excludeIf velocityTest="$patient.gender =='M' ">
                                                                    <obs conceptId="374" answerConceptId="5279"
                                                                         answerLabel="3 - Injectable"/>
                                                                    <obs conceptId="374" answerConceptId="5277"
                                                                         answerLabel="7 - Fertility Awareness Methods"/>
                                                                </excludeIf>
                                                            </span>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <span class="family-planning-methods">
                                                                <excludeIf velocityTest="$patient.gender =='M' ">
                                                                    <obs conceptId="374" answerConceptId="162961"
                                                                         answerLabel="4 - Implants"/>
                                                                </excludeIf>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </excludeIf>
                                                <excludeIf velocityTest="$patient.gender =='M' ">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            Intention to conceive in the next three months
                                                        </div>
                                                        <div class="col-md-1">
                                                            <obs conceptId="165316" answerConceptIds="1065,1066"
                                                                 answerLabels="Yes,No" style="radio"
                                                                 class="horizontal"/>
                                                        </div>
                                                        <div class="col-md-1">
                                                            CaCx Status
                                                        </div>
                                                        <div class="col-md-5">
                                                            <obs conceptId="165315" id="cacxStatus"
                                                                 answerConceptIds="165313, 1175, 165314, 1364"
                                                                 answerLabels="No evidence of Malignancy, Not Applicable, Suspicious of Malignancy, Not eligible"/>
                                                        </div>
                                                    </div>
                                                </excludeIf>
                                            </div>
                                        </div>
                                    </section>
                                </div>

                                <div class="tab-pane fade" id="tb-treatment-clinical-assessment">
                                    <section>
                                        <div class="card">
                                            <div class="card-header">TB Treatment</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <label>Tb Status</label>
                                                        <obs id="tb-status" class="long-value-select" conceptId="90216"
                                                             answerConceptIds="90079,90073, 165295, 165296, 165297, 165298, 165299,165300,90071,99421"
                                                             answerLabels="1 - No signs,2 - Presumptive, 3C - TB Diagnosed - Clinically diagnosed,  3G - TB Diagnosed - Gene Xpert, 3L - TB Diagnosed - TB LAM,3M - TB Diagnosed -TB Microscopy, 3X - TB Diagnosed - Chest Xray, 3O - TB Diagnosed - Others, 4 - Tb Rx - Currently on TB treatment, 5 - Completed TB Treatment"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>TB Start Date</label>
                                                        <obs id="tb-start-date" conceptId="90217"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>Reg No.</label>
                                                        <span id="district-tb-no">
                                                            <obs conceptId="99031"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>TB Stop Date</label>
                                                        <obs id="tb-stop-date" conceptId="90310"
                                                             allowFutureDates="true"/>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <label>TPT Status</label>
                                                    <obs id="tpt-status" conceptId="165288"
                                                         answerConceptIds="1090,90072,165307,90040,160035"
                                                         answerLabels="H0-Never Initiated,H1-On INH,H2-Defaulted,H3-Taken off due to side effects,H4-Completed"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>TPT Date Initiated</label>
                                                        <obs id="tpt-initiation-date" conceptId="165226"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>TPT Date Completed</label>
                                                        <obs id="tpt-completion-date" conceptId="165227"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>TPT Side Effects</label>
                                                        <obs id="tpt-side-effects" conceptId="165792"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card">
                                            <div class="card-header">
                                                TPT/B6
                                            </div>
                                            <div class="card-body">
                                                <obsgroup groupingConceptId="165305">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <br/>
                                                            <obs conceptId="1282" answerConceptSetIds="160021"
                                                                 style="radio"
                                                                 answerConceptIds="78280" answerLabels="Isoniazid"
                                                                 class="horizontal" id="isoniazid"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>No. of Pills</label>
                                                            <obs conceptId="160856" id="no-of-isoniazid"/>
                                                        </div>
                                                        <div class="col-md-3 duration">
                                                            <label>No. of Days</label>
                                                            <obs conceptId="159368" id="duration-on-isoniazid" />
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <br/>
                                                            <obs conceptId="1282" answerConceptSetIds="160021"
                                                                 style="radio"
                                                                 answerConceptIds="82912" answerLabels="Vitamin B6"
                                                                 class="horizontal" id="vitamin-b6"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>No. of Pills</label>
                                                            <obs conceptId="160856" id="no-of-vitamin-b6"/>
                                                        </div>
                                                        <div class="col-md-3 duration">
                                                            <label>No. of Days</label>
                                                            <obs conceptId="159368" id="duration-on-vitamin-b6"/>
                                                        </div>
                                                    </div>
                                                </obsgroup>
                                            </div>
                                        </div>

                                        <div class="card">
                                            <div class="card-header">Signs and Symptoms</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <span class="signs-and-symptoms">
                                                            <obs conceptId="90251" answerConceptId="90139"
                                                                 answerLabel="1 - Oral or anal ulcers"/>
                                                            <obs conceptId="90251" answerConceptId="16"
                                                                 answerLabel="5 - Diarrhea > 1 week"/>
                                                            <obs conceptId="90251" answerConceptId="5953"
                                                                 answerLabel="9 - Double or Blurry vision"/>
                                                            <obs conceptId="90251" answerConceptId="90132"
                                                                 answerLabel="13 - Cough or shortness of breath > 1 week"/>
                                                        </span>
                                                        <span id="enable-disable-signs-and-symptoms">
                                                            <obs conceptId="90251" answerConceptId="90002"
                                                                 answerLabel="17 - Other specify"/>
                                                        </span>
                                                        <span id="signs-and-symptoms-enabled">
                                                            <obs conceptId="99113"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <span class="signs-and-symptoms">
                                                            <obs conceptId="90251" answerConceptId="206"
                                                                 answerLabel="2 - New seizure"/>
                                                            <obs conceptId="90251" answerConceptId="165286"
                                                                 answerLabel="6 - Acting unusual"/>
                                                            <obs conceptId="90251" answerConceptId="861"
                                                                 answerLabel="10 - Decreased hearing"/>
                                                            <obs conceptId="90251" answerConceptId="90116"
                                                                 answerLabel="14 - Fever, chills or night sweats > 1 week"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <span class="signs-and-symptoms">
                                                            <obs conceptId="90251" answerConceptId="165285"
                                                                 answerLabel="3 - Weak arms or legs"/>
                                                            <obs conceptId="90251" answerConceptId="90135"
                                                                 answerLabel="7 - Weight loss in last month"/>
                                                            <obs conceptId="90251" answerConceptId="90130"
                                                                 answerLabel="11 - Whites spots/thrush in mouth"/>
                                                            <obs conceptId="90251" answerConceptId="79"
                                                                 answerLabel="15 - Red/purple or dark spots on skin"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <span class="signs-and-symptoms">
                                                            <obs conceptId="90251" answerConceptId="90094"
                                                                 answerLabel="4 - Headache"/>
                                                            <obs conceptId="90251" answerConceptId="165287"
                                                                 answerLabel="8 - Difficulty walking"/>
                                                            <obs conceptId="90251" answerConceptId="118789"
                                                                 answerLabel="12 - Difficulty or painful swallowing"/>
                                                            <obs conceptId="90251" answerConceptId="122936"
                                                                 answerLabel="16 - Unable to walk without assisstance"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card ">
                                            <div class="card-header">Side effects of ART</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <obs conceptId="90227" answerConceptId="90091"
                                                             answerLabel="Nausea"/>
                                                        <obs conceptId="90227" answerConceptId="90093"
                                                             answerLabel="Fatigue"/>
                                                        <obs conceptId="90227" answerConceptId="90115"
                                                             answerLabel="Jaundice"/>
                                                        <span id="enable-disable-side-effects-of-art">
                                                            <obs conceptId="90227" answerConceptId="90002"
                                                                 answerLabel="Other specify"/>
                                                        </span>
                                                        <span id="side-effects-of-art-enabled">
                                                            <obs conceptId="99113"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs conceptId="90227" answerConceptId="90098"
                                                             answerLabel="Rash"/>
                                                        <obs conceptId="90227" answerConceptId="90100"
                                                             answerLabel="Abdominal pain"/>
                                                        <obs conceptId="90227" answerConceptId="122983"
                                                             answerLabel="Vomiting"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs conceptId="90227" answerConceptId="90092"
                                                             answerLabel="Diarrhoea"/>
                                                        <obs conceptId="90227" answerConceptId="90094"
                                                             answerLabel="Headache"/>
                                                        <obs conceptId="90227" answerConceptId="90095"
                                                             answerLabel="BN - Burning/Numb/Tingling"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs conceptId="90227" answerConceptId="90099"
                                                             answerLabel="Anaemia"/>
                                                        <obs conceptId="90227" answerConceptId="90116"
                                                             answerLabel="FAT"/>
                                                        <obs conceptId="90227" answerConceptId="90117"
                                                             answerLabel="CNS - Dizzy, anxiety, nightmare, depression"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">Diagnosis</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <encounterDiagnoses required="false" selectedDiagnosesTarget=""
                                                                            preferredCodingSource="ICD-10-WHO"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">Advanced Disease Status and WHO Clinical Stage
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-2">
                                                        <label>Advanced Disease Status</label>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs conceptId="165272" class="long-value-select"
                                                             answerConceptIds="165309, 165266, 165267, 165268, 165269, 165270, 165271"
                                                             answerLabels="1 - No Adv. Disease, 2 - Suspected Adv. Disease, 3a - Confirmed Adv. Disease CD4 &lt; 200, 3b - Confirmed Adv. Disease - Pos CrAg,
                                                         3c - Confirmed Adv. Disease - Pos TB, 3d - Confirmed Adv. Disease - WHO Stage 3/4, 3e - Confirmed Adv. Disease - Child &lt; 5 Yrs"/>
                                                    </div>
                                                    <div class="col-md-1"></div>
                                                    <div class="col-md-2">
                                                        <label>WHO Clinical stages</label>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs id="who-clinic-stage" class="long-value-select" conceptId="90203"
                                                             answerConceptIds="90033,90034,90035,90036,90293,90294,90295,90296"
                                                             answerLabels="1,2,3,4,T1,T2,T3,T4"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">Hepatitis B status and Syphilis Status</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <label>Hep B Status</label>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs conceptId="1322" answerConceptIds="159971,90001"
                                                             answerLabels="T - Tested, NT - Not Tested" style="radio"
                                                             class="hepB-status horizontal"/>
                                                    </div>
                                                    <label>Hep B Results (if tested)</label>
                                                    <div class="col-md-3">
                                                        <obs id="1322" conceptId="1322" answerConceptIds="703,664"
                                                             answerLabels="Pos - Positive,Neg - Negative" style="radio"
                                                             class="hepB-results horizontal"/>
                                                    </div>
                                                    <label>Syphilis Status</label>
                                                    <div class="col-md-2">
                                                        <obs conceptId="99753" class="long-value-select"
                                                             answerConceptIds="162848,99756,99755,99754"
                                                             answerLabels=" 1 - No symptoms, 2 - Symptomatic Non-Reactive, 3 - Symptomatic Reactive, 4 - Symptomatic Reactive and treated"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                </div>

                                <div class="tab-pane fade" id="medication">
                                    <section>
                                        <div class="card">
                                            <div class="card-header">
                                                Ctx/Dapsone
                                            </div>
                                            <div class="card-body">
                                                <obsgroup groupingConceptId="165304">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <br/>
                                                            <obs id="99413" conceptId="99413" answerConceptIds="1065,1066" labelText="Given:
" class="horizontal" style="radio"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <br/>
                                                            <obs id="99413-target" conceptId="1282" class="horizontal"
                                                                 answerConceptSetIds="1157"
                                                                 answerConceptIds="92,90168"
                                                                 answerLabels="Dapsone,Cotrimoxazole"   style="radio"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <obs labelText="Number of Pills" id="160856" conceptId="160856"/>
                                                        </div>

                                                        <div class="col-md-4 duration">
                                                            <label>Number of Days</label>
                                                            <obs conceptId="159368"/>
                                                        </div>
                                                    </div>
                                                </obsgroup>
                                            </div>
                                        </div>

                                        <div class="card">
                                            <div class="card-header">
                                                Fluconazole
                                            </div>
                                            <div class="card-body">
                                                <obsgroup groupingConceptId="165306">
                                                    <div class="row">
                                                        <div class="col-md-2">
                                                            <br/>
                                                            <obs conceptId="1282" answerConceptSetIds="165308"
                                                                 answerConceptIds="747"
                                                                 answerLabels="Fluconazole"
                                                                 style="radio"
                                                                 class="horizontal"/>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <obs labelText="No. of Pills" conceptId="160856"/>
                                                        </div>
                                                        <div class="col-2 duration">
                                                            <obs conceptId="159368" labelText="No. of Days"/>
                                                        </div>

                                                        <div class="col-md-2">
                                                            <obs conceptId="1190" labelText="Start Date"/>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <obs conceptId="1191" labelText="Stop Date"/>
                                                        </div>
                                                    </div>
                                                </obsgroup>
                                            </div>
                                        </div>
                                        <div class="card">
                                                <div class="card-header">
                                                    <label>Essential Medications</label>
                                                </div>
                                                <div class="card-body">
                                                    <div>
                                                        <repeat>
                                                            <template>
                                                                <obsgroup groupingConceptId="160741">
                                                                    <div class="row multi-drug" id="{id}-toggleContainer">
                                                                        <div class="col-2">
                                                                            <obs labelText="Drugs"  id="{id}-drug" conceptId="1282" answerClasses="Drug" style="autocomplete" class="fullwidth"/>
                                                                        </div>
                                                                        <div class="col-2">
                                                                            <obs labelText="Quantity" conceptId="160856"/>
                                                                        </div>
                                                                        <div class="col-2">
                                                                            <obs labelText="Qty unit" conceptId="165791" answerConceptSetIds="162402,162384"/>
                                                                        </div>
                                                                        <div class="col-2 duration">
                                                                            <label>Duration</label>
                                                                            <obs conceptId="159368"/>
                                                                        </div>
                                                                        <div class="col-2">
                                                                            <obs conceptId="1732" labelText="Duration unit"/>
                                                                        </div>
                                                                        <div class="col-2">
                                                                            <div class="add-entry">
                                                                                <a href="#" id="{id}-addEntry" class="addEntry add-more-link"><i class="icon-plus-sign"></i></a>
                                                                                <a href="#" class="removeEntry remove-more-link" id="{id}-removeEntry"><i class="icon-minus"></i></a>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </obsgroup>
                                                            </template>
                                                            <render id="1"/>
                                                            <render id="2"/>
                                                            <render id="3"/>
                                                            <render id="4"/>
                                                            <render id="5"/>
                                                            <render id="6"/>
                                                            <render id="7"/>
                                                            <render id="8"/>
                                                            <render id="9"/>
                                                            <render id="10"/>
                                                        </repeat>
                                                    </div>
                                                </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">
                                                <label>Other Medications</label>
                                            </div>
                                            <div class="card-body">
                                                <div>
                                                    <repeat>
                                                        <template>
                                                            <obsgroup groupingConceptId="165874">
                                                                <div class="row multi-drug-other" id="{id}-toggleContainer-other">
                                                                    <div class="col-2">
                                                                        <obs labelText="Drug" id="{id}-drugother" conceptId="99035" class="fullwidth"/>
                                                                    </div>
                                                                    <div class="col-2">
                                                                        <obs labelText="Quantity" conceptId="160856"/>
                                                                    </div>
                                                                    <div class="col-2">
                                                                        <obs labelText="Qty unit" conceptId="165791" answerConceptSetIds="162402,162384"/>
                                                                    </div>
                                                                    <div class="col-2 duration">
                                                                        <label>Duration</label>
                                                                        <obs conceptId="159368"/>
                                                                    </div>
                                                                    <div class="col-2">
                                                                        <obs conceptId="1732" labelText="Duration unit"/>
                                                                    </div>
                                                                    <div class="col-2">
                                                                        <div class="add-entry">
                                                                            <a href="#" id="{id}-addEntry-other" class="addEntry-other add-more-link"><i class="icon-plus-sign"></i></a>
                                                                            <a href="#" class="removeEntry-other remove-more-link" id="{id}-removeEntry-other"><i class="icon-minus"></i></a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </obsgroup>
                                                        </template>
                                                        <render id="1"/>
                                                        <render id="2"/>
                                                        <render id="3"/>
                                                        <render id="4"/>
                                                        <render id="5"/>
                                                        <render id="6"/>
                                                        <render id="7"/>
                                                        <render id="8"/>
                                                        <render id="9"/>
                                                        <render id="10"/>
                                                    </repeat>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card">
                                            <div class="card-header">Art</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <label>Adherence</label>
                                                    <div class="col-md-6">
                                                        <span id="art-adherence" class="ART-adherence horizontal">
                                                            <obs conceptId="90221" answerConceptIds="90156,90157,90158"
                                                                 answerLabels=" Good, Fair, Poor" style="radio"/>
                                                        </span>
                                                    </div>
                                                </div>
                                                <label>why Poor/Fair Adherence</label>
                                                <div class="fair-or-poor-art-adherence-reason">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <obs conceptId="90223" answerConceptId="90040"
                                                                 answerLabel="1 - Toxicity"/>
                                                            <obs conceptId="90223" answerConceptId="90149"
                                                                 answerLabel="5 - Too ill"/>
                                                            <obs conceptId="90223" answerConceptId="90152"
                                                                 answerLabel="9 - Delivery/travel problems"/>
                                                            <obs conceptId="90223" answerConceptId="90155"
                                                                 answerLabel="13 - Pill burden or privacy issues"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <obs conceptId="90223" answerConceptId="90146"
                                                                 answerLabel="2 - Share with others"/>
                                                            <obs conceptId="90223" answerConceptId="90150"
                                                                 answerLabel="6 - Stigma/disclosure"/>
                                                            <obs conceptId="90223" answerConceptId="90051"
                                                                 answerLabel="10 - Inability to pay"/>
                                                            <obs conceptId="90223" answerConceptId="99049"
                                                                 answerLabel="14 - Lack of food"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <obs conceptId="90223" answerConceptId="90147"
                                                                 answerLabel="3 - Forgot"/>
                                                            <obs conceptId="90223" answerConceptId="90045"
                                                                 answerLabel="7 - Drug Stock out"/>
                                                            <obs conceptId="90223" answerConceptId="90153"
                                                                 answerLabel="11 - Alcohol"/>
                                                            <span id="enable-disable-other-poor-art-adherence-reason">
                                                                <obs conceptId="90223" answerConceptId="90002"
                                                                     answerLabel="15 - Other Specify"/>
                                                            </span>
                                                            <span id="other-poor-art-adherence-reason-enabled">
                                                                <obs conceptId="99125"/>
                                                            </span>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <obs conceptId="90223" answerConceptId="90148"
                                                                 answerLabel="4 - Felt better"/>
                                                            <obs conceptId="90223" answerConceptId="90151"
                                                                 answerLabel="8 - Patient lost/ran out of pills"/>
                                                            <obs conceptId="90223" answerConceptId="90154"
                                                                 answerLabel="12 - Depression"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <obsgroup groupingConceptId="165430">
                                                        <div class="col-md-3">
                                                            <obs id="art-regimen" conceptId="90315" labelText="Regimen:"
                                                                 answerConceptIds="99015,99016,99005,99006,164979,99039,99040,164977,99041,99042,99007,99008,99044,99043,99282,99283,99046,99017,99018,99019,99045,99284,99285,99286,99884,99885,164978,99888,163017,99887,90002"
                                                                 answerLabels="d4T-3TC-NVP,d4T-3TC-EFV,AZT-3TC-NVP,AZT-3TC-EFV,AZT-3TC-DTG,TDF-3TC-NVP,TDF-3TC-EFV,TDF-3TC-DTG,TDF-FTC-NVP,TDF-FTC-EFV,ABC-ddI(250)-LPV/r,ABC-ddI(400)-LPV/r,TDF-3TC-LPV/r,TDF-FTC-LPV/r,ZDV-ddI(250)-LPV/r,ZDV-ddI(400)-LPV/r,AZT-3TC-LPV/r,ABC-ddI-LPV/r,ABC-ddI-NFV,ABC-ddI-SQV/r,ZDV-ddI-LPV/r,AZT-ABC-LPV/r,ABC-ddI-ATV/r,AZT-3TC-ATV/r,ABC-3TC-NVP,ABC-3TC-EFV,ABC-3TC-DTG,ABC-3TC-ATV/r,ABC-3TC-LPV/r,TDF-3TC-ATV/r,Other"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>Other Regimen</label>
                                                            <obs id="other-regimen" conceptId="99126"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>No. of Pills</label>
                                                            <obs id="no-of-art-pills" conceptId="99038"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>No. of Days</label>
                                                            <obs id="no-of-art-pills-days" conceptId="99036"/>
                                                        </div>
                                                    </obsgroup>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                </div>

                                <div class="tab-pane fade" id="investigations">
                                    <section>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="card">
                                                    <div class="card-header">CD4</div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <obsgroup groupingConceptId="657">
                                                                <div class="col-md-6">
                                                                    <label>CD4 Count</label>
                                                                    <obs conceptId="5497"
                                                                         allowFutureDates="false"/>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label>CD4%</label>
                                                                    <obs conceptId="730"
                                                                         answerConceptIds="1301,1306,1304"
                                                                         answerLabels="Detected,Not Detected, Sample Rejected"/>
                                                                </div>
                                                            </obsgroup>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card">
                                                    <div class="card-header">Crag</div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <obsgroup groupingConceptId="165418">
                                                                <div class="col-md-6">
                                                                    <label>Crag Results</label>
                                                                    <obs conceptId="165290"
                                                                         answerConceptIds="703,664,1118,1175"
                                                                         answerLabels="Positive, Negative, Not Done, Not Applicable" />
                                                                </div>
                                                            </obsgroup>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card">
                                                    <div class="card-header">Rapid plasma reagin Test (RPR)</div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <obsgroup groupingConceptId="165417">
                                                                <div class="col-md-6">
                                                                    <label>RPR Results</label>
                                                                    <obs conceptId="165289"
                                                                         answerConceptIds="1228,1229,1118,1175"
                                                                         answerLabels="Reactive, Non-reactive, Not Done, Not Applicable" />
                                                                </div>
                                                            </obsgroup>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card">
                                                    <div class="card-header">TB LAM</div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <obsgroup groupingConceptId="165416">
                                                                <div class="col-md-6">
                                                                    <label>TB LAM Results</label>
                                                                    <obs conceptId="165291"
                                                                         answerConceptIds="703,664,1118,1175"
                                                                         answerLabels="Positive, Negative, Not Done, Not Applicable" />
                                                                </div>
                                                            </obsgroup>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="card">
                                                    <div class="card-header">Gene Xpert</div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <obsgroup groupingConceptId="165413">
                                                                <div class="col-md-6">
                                                                    <label>Gene xpert results</label>
                                                                    <obs conceptId="162202"
                                                                         answerConceptIds="703,664,1118"
                                                                         answerLabels="Positive, Negative, Not Done" />
                                                                </div>
                                                            </obsgroup>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card">
                                                    <div class="card-header">Microscopy</div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <obsgroup groupingConceptId="165415">
                                                                <div class="col-md-6">
                                                                    <label>Microscopy Results</label>
                                                                    <obs id="" conceptId="165414"
                                                                         answerConceptIds="703,664"
                                                                         answerLabels="Positive, Negative" />
                                                                </div>
                                                            </obsgroup>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card">
                                                    <div class="card-header">Viral Load</div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <obsgroup groupingConceptId="165412">
                                                                <div class="col-md-6">
                                                                    <label>Date Viral Load Taken</label>
                                                                    <obs id="date-viral-load-taken" conceptId="163023"
                                                                         allowFutureDates="false"/>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label>Viral Load Results</label>
                                                                    <obs id="viral-load-results-qualitative"
                                                                         conceptId="1305"
                                                                         answerConceptIds="1301,1306,1304"
                                                                         answerLabels="Detected,Not Detected, Sample Rejected"/>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label>Viral Load (copies/ml)</label>
                                                                    <obs id="viral-load-results-copies"
                                                                         conceptId="856"/>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label>Viral Load Status</label>
                                                                    <span id="viral-load-status"></span>
                                                                </div>
                                                            </obsgroup>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--here the implementation for other tests-->
                                            <div class="col-md-8">
                                                <div class="card">
                                                    <div class="card-header">Other Investigations</div>
                                                    <div class="card-body">
                                                        <div>
                                                            <repeat>
                                                                <template>
                                                                    <obsgroup groupingConceptId="165877">
                                                                        <div class="row multi-test" id="{id}-toggleContainer3">
                                                                            <div class="col-md-3">
                                                                                <obs labelText="Test Name" conceptId="165875"/>
                                                                            </div>
                                                                            <div class="col-md-3">
                                                                                <obs labelText="Results" conceptId="165876"/>
                                                                            </div>
                                                                            <div class="col-md-3">
                                                                                <div class="add-entry3">
                                                                                    <a href="#" id="{id}-addEntry3" class="addEntry3 add-more-link"><i class="icon-plus-sign"></i></a>
                                                                                    <a href="#" class="removeEntry3 remove-more-link" id="{id}-removeEntry3"><i class="icon-minus"></i></a>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </obsgroup>
                                                                </template>
                                                                <render id="1"/>
                                                                <render id="2"/>
                                                                <render id="3"/>
                                                                <render id="4"/>
                                                                <render id="5"/>
                                                                <render id="6"/>
                                                                <render id="7"/>
                                                                <render id="8"/>
                                                                <render id="9"/>
                                                                <render id="10"/>
                                                            </repeat>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">DSD Model</div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <label>Duration on Current Regimen</label>
                                                        <obs id="duration-on-current-regimen" conceptId="99025"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                    <label>Duration on ART</label>
                                                        <obs id="duration-on-art" conceptId="99024"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>Patient Categorization</label>
                                                        <obs id="patient-categorization" conceptId="165144"
                                                             answerConceptIds="90003,90004"
                                                             answerLabels="S - Stable, US - Unstable"
                                                             class="horizontal"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>Approach</label>
                                                        <obs id="165143" conceptId="165143"
                                                             answerConceptIds="165138,165140,165139,165142,165141"
                                                             answerLabels="FBIM - Facility Based Individual Management, FBG - Facility Based Group, FTDR - Fast-Track Drug Refills, CDDP - Community Drug Distribution Point, CCLAD - Community Client-Led ART Delivery"
                                                             class="long-value-select" required="required"/>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <label>Visit Type</label>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <obs conceptId="160288" answerConceptIds="164969,165284"
                                                             answerLabels="R - Drug Refill ONLY, C - Clinical Assessment/Drug refill and/or Tests/Investigations"
                                                             style="radio" class="horizontal"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </restrictByRole>

    <restrictByRole exclude="Data Clerk,System Developer,Organizational: System Administrator">
    <div class="card poc-art-form">
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">

                    <div class="card">
                        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                            <a class="nav-link nav-link-1 links active active-1" id="clinical-encounter-menu-poc" href="#encounter-card-poc" data-toggle="pill"
                               role="tab" aria-selected="true">Clinical Encounter
                            </a>
                            <a class="nav-link links nav-link-1" id="investigations-menu-poc" href="#investigation-reports-poc" data-toggle="pill"
                               role="tab" aria-selected="false">Investigation Reports
                            </a>
                            <a class="nav-link links nav-link-1" id="diagnosis-menu-poc" href="#diagnosis-poc" data-toggle="pill"
                               role="tab" aria-selected="false">Diagnosis
                            </a>
                            <a class="nav-link links nav-link-1" id="medication-menu-poc" href="#medication-poc" data-toggle="pill"
                               role="tab" aria-selected="false">Medication
                            </a>
                            <a class="nav-link links nav-link-1" id="dsdm-menu-poc" href="#programing-dsdm-poc" data-toggle="pill"
                               role="tab" aria-selected="false">Programming ie DSDM
                            </a>
                            <a class="nav-link links nav-link-1" id="course-of-action-menu-poc" href="#next-course-of-action" data-toggle="pill"
                               role="tab" aria-selected="false">Next Course of Action
                            </a>
                        </div>
                    </div>

                    <div class="encounter-details">
                        <div class="hidden">
                            <label>Encounter Date</label>
                            <encounterDate default="today" disallowMultipleEncountersOnDate="block"/>
                            <encounterLocation id="location_id"
                                               default="SessionAttribute:emrContext.sessionLocationId"/>

                        </div>
                        <div class="submission-section hidden">
                            <encounterProviderAndRole encounterRole="240b26f9-dd88-4172-823d-4a8bfeb7841f"
                                                      required="required" default="currentUser"/>
                        </div>
                        <div class="submission-section">
                            <submit submitStyle="customSubmit" class="confirm" submitLabel="SAVE"/>
                            <postSubmissionAction
                                    class="org.openmrs.module.ugandaemrpoc.htmlformentry.HIVClinicalAssessmentSubmissionAction"/>
                        </div>
                    </div>

                </div>

                <div class="col-md-9">

                    <div class="card" id="encounter-card-poc">

                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs nav-fill">
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#patient-vitals">
                                        Triage Information
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#nav-family-planning">
                                        Pregnancy/ Family Planning
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#nav-contact">
                                        Examination
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#nav-investigations">Investigations</a>
                                </li>
                            </ul>
                        </div>

                        <div class="card-body">
                            <div class="tab-content">

                                <div class="tab-pane fade show active" id="patient-vitals" >
                                    <uiInclude provider="ugandaemrpoc" fragment="vitals"/>
                                </div>
                                <div class="tab-pane fade" id="nav-family-planning" role="tabpanel" >

                                    <div class="row">
                                        <excludeIf velocityTest="$patient.gender =='M' || $patient.age &lt; 9">
                                            <div class="col-md-6">
                                                <div class="card">
                                                    <div class="card-header">
                                                        <label>Pregnancy and EmTCT</label>
                                                    </div>
                                                    <div class="card-body">
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-10">
                                                                <label>Pregnancy Status</label>
                                                                    <span class="pregnancy">
                                                                        <obs conceptId="90041" answerConceptId="1065"
                                                                             answerLabel="P - Pregnant"
                                                                             id="pregnant"/>
                                                                        <obs conceptId="90041" answerConceptId="99601"
                                                                             answerLabel="BF - Breast Feeding"
                                                                             id="breast-feeding"/>
                                                                        <obs conceptId="90041" answerConceptId="1066"
                                                                             answerLabel="NPB - Not pregnant or not breast feeding"
                                                                             id="not-pregnant-not-breast-feeding"/>
                                                                        <obs conceptId="90041" answerConceptId="1175"
                                                                             answerLabel="NA - Not Applicable"
                                                                             id="not-pregnant-not-applicable"/>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <label>EDD</label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <obs id="edd" conceptId="5596"
                                                                         allowFutureDates="true"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <label>In EMTCT</label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <obs id="emtct" conceptId="90012"
                                                                         answerConceptIds="90003,90004"
                                                                         answerLabels="Yes,No" class="horizontal"
                                                                         style="radio"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <label>Gestation in Weeks</label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <obs id="age-in-months" conceptId="162983"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <label>ANC No.</label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <span id="anc_no">
                                                                    <patient field="identifier"
                                                                             identifierTypeId="b0cc255e-ef57-4266-839e-0df7f5099eb9"
                                                                             required="false"/>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </excludeIf>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <label>Family Planning</label>
                                                </div>
                                                <div class="card-body">
                                                    <div>
                                                        <div class="row">
                                                            <div class="col-md-5">
                                                                <label>Family Planning Status</label>
                                                            </div>
                                                            <div class="col-md-7">
                                                                <obs id="enable-disable-family-planning-methods" class="horizontal"
                                                                     conceptId="90238"
                                                                     answerConceptIds="90082,90081"
                                                                     answerLabels="Yes,No"
                                                                     style="radio"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <label>Methods</label>
                                                    </div>
                                                    <div>
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <span class="family-planning-methods">
                                                                <obs conceptId="374" answerConceptId="190"
                                                                     answerLabel="Condoms"/>
                                                                <excludeIf velocityTest="$patient.gender =='M' ">

                                                                    <obs conceptId="374"
                                                                         answerConceptId="780"
                                                                         answerLabel="Oral Contraceptive pills"/>
                                                                    <obs conceptId="374"
                                                                         answerConceptId="5279"
                                                                         answerLabel="Injectable"/>
                                                                    <obs conceptId="374" answerConceptId="162961"
                                                                         answerLabel="Implants"/>
                                                                    <obs conceptId="374"
                                                                         answerConceptId="5278"
                                                                         answerLabel="Diaphram/Cervical Cap"/>
                                                                    <obs conceptId="374"
                                                                         answerConceptId="5275"
                                                                         answerLabel="Intra uterine device (IUD)"/>

                                                                    <obs conceptId="374" answerConceptId="5277"
                                                                         answerLabel="Fertility Awareness Methods"/>

                                                                </excludeIf>
                                                                <obs conceptId="374" answerConceptId="99265"
                                                                     answerLabel="Vasectomy/Tubal ligation"/>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <excludeIf velocityTest="$patient.gender =='M' ">
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-9">
                                                                    <label>Intention to conceive in the next three months</label>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <obs conceptId="165316" answerConceptIds="1065,1066"
                                                                         answerLabels="Yes,No" style="radio"
                                                                         class="horizontal"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <label>CaCx screening</label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <obs conceptId="165315" id="cacxStatus"
                                                                         answerConceptIds="165313, 1175, 165314, 1364"
                                                                         answerLabels="No evidence of Malignancy, Not Applicable, Suspicious of Malignancy, Not eligible"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </excludeIf>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="nav-contact">
                                    <div class="assesment">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="card">
                                                    <div class="card-header">Presenting Signs and Symptoms</div>
                                                    <div class="card-body">
                                                        <span class="lablex2">
                                                            <repeat with="['90139','Oral or anal ulcers'],['206',' New seizure'],['165285','Weak arms or legs'],['90094','Headache'],['16','Diarrhea'],['165286',' Acting unusual'],['90135','Weight loss in last month'],['165287','Difficulty walking'],['5953','Double or Blurry vision'],['861','Decreased hearing'],['90130','Whites spots/thrush in mouth'],['118789','Difficulty or painful swallowing'],['90116','Fever, chills or night sweats'],['79','Red/purple or dark spots on skin'],['122936 ','Unable to walk without assisstance'],['90132','Cough or shortness of breath > 1 week']">
                                                                <obs id="{0}" conceptId="90251" answerConceptId="{0}"
                                                                     answerLabel="{1}" style="checkbox"/>
                                                            </repeat>
                                                            <span id="trigger">
                                                                <obs id="enable-disable-signs-and-symptoms" conceptId="90251"
                                                                     answerConceptId="90002"
                                                                     answerLabel="Other specify"/>
                                                            </span>
                                                            <span id="disabled">
                                                                <obs id="signs-and-symptoms-enabled" conceptId="99032" size="17" />
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="card">
                                                    <div class="card-header">Side Effects of ART</div>
                                                    <div class="card-body">
                                                        <span class="lablex2">
                                                            <repeat with="['90091','Nausea'],['90098','Rash'],['90092','Diarrhoea'],['90099','Anaemia'],['90093','Fatigue'],['90100','Abdominal pain'],['90094','Headache'],['90116','FAT'],['90115','Jaundice'],['122983','Vomiting'],['90095','BN - Burning/Numb/Tingling'],['90117','CNS - Dizzy, anxiety, nightmare, depression']">
                                                                <obs id="{0}" conceptId="90227" answerConceptId="{0}"
                                                                     answerLabel="{1}" style="checkbox"/>
                                                            </repeat>
                                                            <span id="enable-disable-side-effects-of-art">
                                                                <obs conceptId="90227" answerConceptId="90002"
                                                                     answerLabel="Other specify"/>
                                                            </span>
                                                            <span id="side-effects-of-art-enabled">
                                                                <obs conceptId="99113" size="17"/>
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="card">
                                                    <div class="card-header">Syphilis Status</div>
                                                    <div class="card-body">
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <label>Hep B Status</label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <obs conceptId="1322" answerConceptIds="159971,90001"
                                                                         answerLabels="T - Tested, NT - Not Tested"
                                                                         style="radio"
                                                                         class="hepB-status horizontal"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <label>Hep B Results (if tested)</label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <obs conceptId="1322" answerConceptIds="703,664"
                                                                         answerLabels="Pos - Positive,Neg - Negative"
                                                                         style="radio"
                                                                         class="hepB-results horizontal"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <label>Syphilis Status</label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <obs conceptId="99752"
                                                                         answerConceptIds="162848,99756,99755,99754"
                                                                         answerLabels="No Symptoms,Symptomatic Non-Reactive,Symptomatic Reactive, Symptomatic Reactive and treated"
                                                                         labelText=""/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card">
                                                    <div class="card-header">Advanced Disease and WHO Clinical Stage
                                                    </div>
                                                    <div class="card-body">
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-5">
                                                                    <label>Advanced Disease Status</label>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <obs conceptId="165272"
                                                                         answerConceptIds="165309, 165266, 165267, 165268, 165269, 165270, 165271"
                                                                         answerLabels="1 - No Adv. Disease, 2 - Suspected Adv. Disease, 3a - Confirmed Adv. Disease CD4 &lt; 200, 3b - Confirmed Adv. Disease - Pos CrAg, 3c - Confirmed Adv. Disease - Pos TB, 3d - Confirmed Adv. Disease - WHO Stage 3/4, 3e - Confirmed Adv. Disease - Child &lt; 5 Yrs" class="long-value-select"/>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-5">
                                                                    <lable>WHO Clinical Stage</lable>
                                                                </div>
                                                                <div class="col-md-7">
                                                                    <obs id="who-clinic-stage" conceptId="90203"
                                                                         answerConceptIds="90033,90034,90035,90036,90293,90294,90295,90296"
                                                                         answerLabels="1,2,3,4,T1,T2,T3,T4"
                                                                         labelText=""/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card">
                                                    <div class="card-header">TB Status</div>
                                                    <div class="card-body">
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <label>TB Status</label>
                                                                </div>
                                                                <div class="col-md-7">
                                                                    <obs id="tb-status" class="long-value-select"
                                                                         conceptId="90216"
                                                                         answerConceptIds="90079,90073, 165295, 165296, 165297, 165298, 165299,165300,90071"
                                                                         answerLabels="1 - No signs,2 - Presumptive, 3C - TB Diagnosed - Clinically diagnosed,  3G - TB Diagnosed - Gene Xpert, 3L - TB Diagnosed - TB LAM,3M - TB Diagnosed -TB Microscopy, 3X - TB Diagnosed - Chest Xray, 3O - TB Diagnosed - Others, 4 - Tb Rx"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <label>TB Start Date</label>
                                                                </div>
                                                                <div class="col-md-9">
                                                                    <obs id="tb-start-date" conceptId="90217"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <label>TB Stop Date</label>
                                                                </div>
                                                                <div class="col-md-9">
                                                                    <obs id="tb-stop-date" conceptId="90310"
                                                                         allowFutureDates="true"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <label>Reg No.</label>
                                                                </div>
                                                                <div class="col-md-9">
                                                                    <span id="district-tb-no">
                                                                        <obs conceptId="99031"/>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="card">
                                                    <div class="card-header">TB AND TPT</div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <div class="col-md-5">
                                                                <label>TPT Status</label>
                                                            </div>
                                                            <div class="col-md-7">
                                                                <obs id="tpt-status" conceptId="165288"
                                                                     answerConceptIds="1090,90072,165307,90040,160035"
                                                                     answerLabels="Never Initiated,On INH,Defaulted,Taken off due to side effects,Completed"/>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-5">
                                                                <label>TPT Date Initiated</label>
                                                            </div>
                                                            <div class="col-md-7">
                                                                <obs conceptId="165226"/>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-5">
                                                                <label>TPT Date Completed</label>
                                                            </div>
                                                            <div class="col-md-7">
                                                                <obs conceptId="165227"/>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-5">
                                                                <label>TPT Side Effects</label>
                                                            </div>
                                                            <div class="col-md-7">
                                                                <obs conceptId="165792"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="nav-investigations">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <label>Laboratory Tests</label>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row investigations">
                                                        <span class="lablex2">
                                                            <repeat with="['165418','CrAg'],['165417','RPR'],['165416','TB LAM'],['165413','GeneXpert'],['165415','Microscopy'],['1019','CBC'],['657','Cd4'],['165412','VL']">
                                                                <obs id="{0}" conceptId="1271" answerConceptId="{0}"
                                                                     answerLabel="{1}" style="checkbox"/>
                                                            </repeat>
                                                        </span>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <label>Radiology</label>
                                                </div>
                                                <div class="card-body">
                                                    <div class="investigations">
                                                        <repeat with="['12','CXR']">
                                                            <obs id="{0}" conceptId="1271" answerConceptId="{0}"
                                                                 answerLabel="{1}" style="checkbox"/>
                                                        </repeat>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <label>Theater</label>
                                                </div>
                                                <div class="card-body">
                                                    <div class="investigations">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card" id="investigation-reports-poc">

                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs">
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#investigation-report-list">
                                        Report
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#investigation-report-form">
                                        Capture Results
                                    </a>
                                </li>
                            </ul>
                        </div>

                         <div class="card-body">
                            <div class="tab-content" id="investigation-report-tab-tabContent">
                                <div class="tab-pane fade show active" id="investigation-report-list">
                                    <uiInclude provider="ugandaemrpoc" fragment="displayResultListOnEncounter"/>
                                </div>
                                <div class="tab-pane fade" id="investigation-report-form">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">CD4/CD4%</div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <obsgroup groupingConceptId="657">
                                                            <div class="col-md-6">
                                                                <label>CD4 Count</label>
                                                                <obs id="" conceptId="5497"
                                                                     allowFutureDates="false"/>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label>CD4%</label>
                                                                <obs conceptId="730"
                                                                     answerConceptIds="1301,1306,1304"
                                                                     answerLabels="Detected,Not Detected, Sample Rejected"/>
                                                            </div>
                                                        </obsgroup>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">Crag</div>
                                                <div class="card-body">
                                                    <obsgroup groupingConceptId="165418">
                                                        <div>
                                                            <label>Crag Results</label>
                                                            <obs id="" conceptId="165290"/>
                                                        </div>
                                                    </obsgroup>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">Rapid Plasma Reagin Test (RPR)</div>
                                                <div class="card-body">
                                                    <obsgroup groupingConceptId="165417">
                                                        <div>
                                                            <label>RPR Results</label>
                                                            <obs id="" conceptId="165289"
                                                                 answerConceptIds="1228,1229,1118,1175"/>
                                                        </div>
                                                    </obsgroup>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">TB LAM</div>
                                                <div class="card-body">
                                                    <obsgroup groupingConceptId="165416">
                                                        <div>
                                                            <label>TB LAM Results</label>
                                                            <obs conceptId="165291"/>
                                                        </div>
                                                    </obsgroup>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">Gene Xpert</div>
                                                <div class="card-body">
                                                    <obsgroup groupingConceptId="165413">
                                                        <div>
                                                            <label>Gene xpert results</label>
                                                            <obs conceptId="162202"
                                                                 answerConceptIds="703,664,1118"/>
                                                        </div>
                                                    </obsgroup>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-header">Microscopy</div>
                                                <div class="card-body">
                                                    <obsgroup groupingConceptId="165415">
                                                        <div>
                                                            <label>Microscopy Results</label>
                                                            <obs conceptId="165414" answerConceptIds="703,664"/>
                                                        </div>
                                                    </obsgroup>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="card">
                                                <div class="card-header">Viral Load</div>
                                                <div class="card-body">
                                                    <obsgroup groupingConceptId="165412">
                                                        <div class="row">
                                                            <div class="col-md-3">
                                                                <label>Date Viral Load Taken</label>
                                                                <obs id="date-viral-load-taken" conceptId="163023"
                                                                     allowFutureDates="false"/>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label>Viral Load Results</label>
                                                                <obs id="viral-load-results-qualitative" conceptId="1305"
                                                                     answerConceptIds="1301,1306,1304"
                                                                     answerLabels="Detected,Not Detected, Sample Rejected"/>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label>Viral Load (copies/ml)</label>
                                                                <obs id="viral-load-results-copies" conceptId="856"/>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label>Viral Load Status</label>
                                                                <span id="viral-load-status"></span>
                                                            </div>
                                                        </div>
                                                    </obsgroup>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card" id="diagnosis-poc">
                        <div class="card-header">Diagnosis</div>
                        <div class="card-body">
                            <encounterDiagnoses selectedDiagnosesTarget="#encounter-diagnoses-target"
                                                preferredCodingSource="ICD-10-WHO"
                                                diagnosisConceptClasses="Diagnosis"/>
                        </div>
                    </div>

                    <div class="card" id="medication-poc">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-header">
                                            ART - adherence
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <span id="art-adherence" class="ART-adherence horizontal">
                                                        <obs conceptId="90221" answerConceptIds="90156,90157,90158"
                                                             answerLabels=" Good, Fair, Poor" style="radio"/>
                                                    </span>
                                                    <div>
                                                        <span class="fair-or-poor-art-adherence-reason">
                                                            <br/>
                                                            <label>Why Poor/Fair</label>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <obs conceptId="90223" answerConceptId="90040"
                                                                         answerLabel="1 - Toxicity"/>
                                                                    <obs conceptId="90223" answerConceptId="90146"
                                                                         answerLabel="2 - Share with others"/>
                                                                    <obs conceptId="90223" answerConceptId="90147"
                                                                         answerLabel="3 - Forgot"/>
                                                                    <obs conceptId="90223" answerConceptId="90148"
                                                                         answerLabel="4 - Felt better"/>
                                                                    <obs conceptId="90223" answerConceptId="90149"
                                                                         answerLabel="5 - Too ill"/>
                                                                    <obs conceptId="90223" answerConceptId="90150"
                                                                         answerLabel="6 - Stigma"/>
                                                                    <obs conceptId="90223" answerConceptId="90045"
                                                                         answerLabel="7 - Drug Stock out"/>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <obs conceptId="90223" answerConceptId="90151"
                                                                         answerLabel="8 - Lost pills"/>
                                                                    <obs conceptId="90223" answerConceptId="90152"
                                                                         answerLabel="9 - Travel problems"/>
                                                                    <obs conceptId="90223" answerConceptId="90051"
                                                                         answerLabel="10 - Inability to pay"/>
                                                                    <obs conceptId="90223" answerConceptId="90153"
                                                                         answerLabel="11 - Alcohol"/>
                                                                    <obs conceptId="90223" answerConceptId="90154"
                                                                         answerLabel="12 - Depression"/>
                                                                    <obs conceptId="90223" answerConceptId="90155"
                                                                         answerLabel="13 - Pill burden"/>
                                                                    <obs conceptId="90223" answerConceptId="99049"
                                                                         answerLabel="14 - Lack of food"/>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <span id="enable-disable-other-poor-art-adherence-reason">
                                                                        <obs conceptId="90223" answerConceptId="90002"
                                                                             answerLabel="15 - Other specify"/>
                                                                    </span>
                                                                </div>
                                                                <div class="col-md-12">
                                                                    <span id="other-poor-art-adherence-reason-enabled">
                                                                        <obs conceptId="99125"/>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="card">
                                        <div class="card-header">
                                            ARV - regimens
                                        </div>
                                        <div class="card-body">
                                            <obsgroup groupingConceptId="165430">
                                                <div class="row arv-regimen">
                                                    <div class="col-md-3">
                                                        <obs id="art-regimen" conceptId="90315" labelText="Regimen"
                                                             answerConceptIds="99015,99016,99005,99006,164979,99039,99040,164977,99041,99042,99007,99008,99044,99043,99282,99283,99046,99017,99018,99019,99045,99284,99285,99286,99884,99885,164978,99888,163017,99887,165797,165796,165795,165808,165807,165806,165805,165804,165803,165802,165801,165800,165799,165798,90002"
                                                             answerLabels="d4T-3TC-NVP,d4T-3TC-EFV,AZT-3TC-NVP,AZT-3TC-EFV,AZT-3TC-DTG,TDF-3TC-NVP,TDF-3TC-EFV,TDF-3TC-DTG,TDF-FTC-NVP,TDF-FTC-EFV,ABC-ddI(250)-LPV/r,ABC-ddI(400)-LPV/r,TDF-3TC-LPV/r,TDF-FTC-LPV/r,ZDV-ddI(250)-LPV/r,ZDV-ddI(400)-LPV/r,AZT-3TC-LPV/r,ABC-ddI-LPV/r,ABC-ddI-NFV,ABC-ddI-SQV/r,ZDV-ddI-LPV/r,AZT-ABC-LPV/r,ABC-ddI-ATV/r,AZT-3TC-ATV/r,ABC-3TC-NVP,ABC-3TC-EFV,ABC-3TC-DTG,ABC-3TC-ATV/r,ABC-3TC-LPV/r,TDF-3TC-ATV/r,AZT/3TC/RAL,ABC/3TC/AZT,TDF/3TC/AZT,DRV/RTV/RAL/ABC/3TC,DRV/RTV/ETV/ABC/3TC,DRV/RTV/RAL/TDF/3TC,DRV/RTV/RAL/AZT/3TC,DRV/RTV/RAL,DRV/RTV/ETV/TDF/3TC,DRV/RTV/ETV/AZT/3TC,DRV/RTV/ETV,DRV/RTV/DTG/TDF/3TC,DRV/RTV/DTG/AZT/3TC,DRV/RTV/DTG,Other"/>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <br/>
                                                        <obs id="split-regimen" conceptId="165809" labelText="Split" style="checkbox"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs class="drug-strength" conceptId="1444" labelText="Strength"/>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <obs id="no-of-art-pills" conceptId="99038" labelText="No. of Pills"/>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <obs id="no-of-art-pills-days" conceptId="99036" labelText="No. of Days"/>
                                                    </div>
                                                </div>
                                            </obsgroup>
                                            <div id="split_regimen_container">
                                                <repeat>
                                                <template>
                                                    <obsgroup groupingConceptId="160741">
                                                        <div class="row multi-arv-drug" id="{id}-toggleContainer1">
                                                            <div class="col-md-4">
                                                                <obs labelText="Drug" conceptId="1282" answerConceptSetIds="99015,99016,99005,99006,164979,99039,99040,164977,99041,99042,99007,99008,99044,99043,99282,99283,99046,99017,99018,99019,99045,99284,99285,99286,99884,99885,164978,99888,163017,99887,90002" style="autocomplete" class="fullwidth"/>
                                                            </div>

                                                            <div class="col-md-3">
                                                                <obs class="drug-strength" conceptId="1444" labelText="Strength"/>
                                                            </div>

                                                            <div class="col-md-2">
                                                                <obs labelText="No. of Pills" conceptId="160856"/>
                                                            </div>

                                                            <div class="col-md-2 duration">
                                                                <obs conceptId="159368" labelText="No. of Days"/>
                                                            </div>
                                                            <div class="col-md-1">
                                                                <br/>
                                                                <div class="add-entry1">
                                                                    <a href="#" id="{id}-addEntry1" class="addEntry1 add-more-link"><i class="icon-plus-sign"></i></a>
                                                                    <a href="#" class="removeEntry1 remove-more-link" id="{id}-removeEntry1"><i class="icon-minus"></i></a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </obsgroup>
                                                </template>
                                                <render id="1"/>
                                                <render id="2"/>
                                                <render id="3"/>
                                                <render id="4"/>
                                                <render id="5"/>
                                                <render id="6"/>
                                                <render id="7"/>
                                                <render id="8"/>
                                                <render id="9"/>
                                                <render id="10"/>
                                            </repeat>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-header">
                                            TPT/B6
                                        </div>
                                        <div class="card-body">
                                            <obsgroup groupingConceptId="165305">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <br/>
                                                        <obs id="isoniazid-trigger" conceptId="1282" answerConceptSetIds="160021"
                                                             style="radio"
                                                             answerConceptIds="78280" answerLabels="Isoniazid"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs class="drug-strength" conceptId="1444" labelText="Strength"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>No. of Pills</label>
                                                        <obs id="isoniazid-pills" conceptId="160856"/>
                                                    </div>
                                                    <div class="col-md-3 duration">
                                                        <label>No. of Days</label>
                                                        <obs conceptId="159368"/>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <br/>
                                                        <obs id="vitamin-b6-trigger" conceptId="1282" answerConceptSetIds="160021"
                                                             style="radio"
                                                             answerConceptIds="82912" answerLabels="Vitamin B6"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs conceptId="1444" labelText="Strength"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>No. of Pills</label>
                                                        <obs id="vitamin-b6-pills" conceptId="160856"/>
                                                    </div>

                                                    <div class="col-md-3 duration">
                                                        <label>No. of Days</label>
                                                        <obs conceptId="159368"/>
                                                    </div>
                                                </div>
                                        </obsgroup>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        CTX/DAPSONE (ANTI-BIOTICS)
                                    </div>
                                    <div class="card-body">
                                        <obsgroup groupingConceptId="165304">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <br/>
                                                    <obs id="99413" conceptId="99413" class="horizontal" answerConceptIds="1065,1066" labelText="Given:
" style="radio"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <br/>
                                                    <obs id="99413-target" conceptId="1282" class="horizontal" answerConceptSetIds="1157"
                                                         answerConceptIds="92,90168" style="radio"/>
                                                </div>
                                            </div>
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <obs class="drug-strength" conceptId="1444" labelText="Strength"/>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <obs labelText="Number of Pills" id="160856" conceptId="160856"/>
                                                    </div>
                                                    <div class="col-md-4 duration">
                                                        <label>Number of Days</label>
                                                        <obs id="159368" conceptId="159368"/>
                                                    </div>
                                                </div>
                                            </obsgroup>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Fluconazole - (Anti-fungal)
                                        </div>
                                        <div class="card-body">
                                            <obsgroup groupingConceptId="165306">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <br/>
                                                        <obs id="fluconazole-trigger" conceptId="1282" answerConceptSetIds="165308"
                                                             answerConceptIds="747" answerLabels="Fluconazole" style="radio" class="horizontal"/>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <obs class="drug-strength" conceptId="1444" labelText="Strength"/>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <obs id="fluconazole-pills" labelText="No. of Pills" conceptId="160856"/>
                                                    </div>
                                                    <div class="col-6 duration">
                                                        <obs conceptId="159368" labelText="No. of Days"/>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <obs conceptId="1190" labelText="Start Date"/>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <obs conceptId="1191" labelText="Stop Date"/>
                                                    </div>
                                                </div>
                                            </obsgroup>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <label>Other Medications</label>
                                        </div>
                                        <div class="card-body">
                                            <div>
                                                <repeat>
                                                    <template>
                                                        <obsgroup groupingConceptId="160741">
                                                            <div class="row multi-drug" id="{id}-toggleContainer">
                                                                <div class="col-md-2">
                                                                    <obs id="other-meds-trigger" labelText="Drug" conceptId="1282" answerClasses="Drug" style="autocomplete" class="fullwidth"/>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <obs class="drug-strength" conceptId="1444" labelText="Strength"/>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <obs id="other-meds-quantity" labelText="Quantity" conceptId="160856"/>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <obs labelText="Qty unit" conceptId="165791" answerConceptSetIds="162402,162384"/>
                                                                </div>
                                                                <div class="col-md-1 duration">
                                                                    <label>Duration</label>
                                                                    <obs conceptId="159368"/>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <obs conceptId="1732" labelText="Duration unit"/>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <div class="add-entry">
                                                                        <a href="#" id="{id}-addEntry" class="addEntry add-more-link"><i class="icon-plus-sign"></i></a>
                                                                        <a href="#" class="removeEntry remove-more-link" id="{id}-removeEntry"><i class="icon-minus"></i></a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </obsgroup>
                                                    </template>
                                                    <render id="1"/>
                                                    <render id="2"/>
                                                    <render id="3"/>
                                                    <render id="4"/>
                                                    <render id="5"/>
                                                    <render id="6"/>
                                                    <render id="7"/>
                                                    <render id="8"/>
                                                    <render id="9"/>
                                                    <render id="10"/>
                                                </repeat>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card" id="programing-dsdm-poc">

                        <div class="card-header">
                            <label>DSDM</label>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <label>Patient categorisation</label>
                                    <obs id="patient-categorization" conceptId="165144" answerConceptIds="90003,90004"
                                         answerLabels="S - Stable, US - Unstable" class="horizontal long-value-select"/>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <obs id="165143" conceptId="165143"
                                             answerConceptIds="165138,165140,165139,165142,165141"
                                             answerLabels="FBIM,FBG,FTR,CDDP,CCLAD" required="required"
                                             labelText="Approach" class="horizontal long-value-select"/>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <obs id="duration-on-art" conceptId="99024"
                                         labelText="Duration (Months since baseline)"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <obs id="duration-on-current-regimen" conceptId="99025"
                                         labelText="Duration (Months on current regimen)"/>
                                </div>
                                <div class="col-md-8">
                                    <label>Visit Type</label>
                                    <obs conceptId="160288" answerConceptIds="164969,165284"
                                         answerLabels="R - Drug Refill ONLY, C - Clinical Assessment/Drug refill and/or Tests/Investigations"
                                         style="radio" class="horizontal"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card" id="next-course-of-action">

                        <div class="card-header">
                            <label>Next Course of Action</label>
                        </div>
                        <div class="card-body">
                            <div class="final-out-come">
                                <div class="row">
                                    <div class="col-md-4">
                                        <excludeIf velocityTest="$patient.person.dead ==true">
                                            <lookup complexExpression="#set($transfer_out_date = '')"/>
                                            <span id="transfer_out_date_id" class="hidden">
                                                <lookup
                                                        complexExpression="#set($transfer_out_date=($fn.latestObs('99165').valueDatetime)) #set($lost_to_follow_date=$fn.latestObs('99165').valueDatetime) #set($transfer_out=$fn.latestObs('90306').valueCoded.name) $transfer_out_date"/>
                                            </span>
                                            <includeIf velocityTest="$transfer_out=='YES'">
                                                <obs id="returndate" conceptId="5096" allowFutureDates="true"
                                                     labelText="Return date"/>
                                            </includeIf>

                                            <includeIf velocityTest="$transfer_out!='YES'">
                                                <obs id="returndate" conceptId="5096" required="required"
                                                     allowFutureDates="true"
                                                     labelText="Return date"/>
                                            </includeIf>
                                        </excludeIf>
                                    </div>
                                    <div class="col-md-4">
                                        <obs id="reason-for-next-appointment" conceptId="160288"
                                             labelText="Reasons for next appointment"
                                             answerConceptIds="164968,164972,164970,856,5497,163153,164971,164973,99324,164974,90012,903,5484,90002"
                                             answerLabels="1. ART Initiation, 2. ART Refill, 3. ART Regimen Switch/ Substitution, 4. Viral Load, 5. CD4, 6. IAC, 7. T.B Drug Refill,8. T.B Follow up, 9. ANC,10. EID,11. PMTCT, 12. Hypertension/ Diabetes, 13. Nutrition,14. Other Specify"/>
                                    </div>
                                    <div class="col-md-4">
                                        <obs id="other-reason-for-next-appointment" conceptId="164975"
                                             labelText="Other Reason for next appointment"/>
                                    </div>
                                </div>
                                <obsgroup groupingConceptId="99166">
                                    <div class="row">
                                        <div class="col-md-4" id="final-out-come">
                                            <obs conceptId="90306" answerConceptId="90003"
                                                 answerLabel="Transfer out"/>
                                        </div>
                                        <div class="col-md-4" id="disabled">
                                            <obs conceptId="99165" labelText="Date of Transfer"/>
                                        </div>
                                        <div class="col-md-4" id="disabled">
                                            <obs conceptId="90211" labelText="Where"/>
                                        </div>
                                    </div>
                                </obsgroup>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </restrictByRole>
</htmlform>